javascript:(()=>{(0,eval)(atob("LyoqCiAqIOWcqOmhtemdoiBDb25zb2xlIOaJp+ihjOOAggogKiDlip/og73vvJoKICogMSkg6I635Y+W5LiA5LiyIElE77yI5Y+v5LuO5oyH5a6a5paH5pys5qGG6K+75Y+W77yM5oiW5by556qX6L6T5YWl77yJCiAqIDIpIOeCueWHu+S4i+aLieaMiemSru+8iEFsbCDlj7PkvqfkuInop5LvvIkKICogMykg5oqKIElEIOWhq+WFpSBTZWFyY2ggdmFsdWUg6L6T5YWl5qGGCiAqIDQpIOeCueWHuyBTZWFyY2gKICogNSkg562JMuenkuWQjueCueWHuyBTZWxlY3QgYWxsIHJlc3VsdHMKICovCihhc3luYyAoKSA9PiB7CiAgLy8g5aaC5p6c5L2g5oOz5LuO6aG16Z2i5p+Q5Liq6L6T5YWl5qGG6K+75Y+WIElE77yM5oqK5a6D5pS55oiQ5a+55bqUIHNlbGVjdG9y77yb55WZ56m65YiZ55SoIHByb21wdCDovpPlhaXjgIIKICBjb25zdCBTT1VSQ0VfSU5QVVRfU0VMRUNUT1IgPSAiIjsKICBjb25zdCBUQVJHRVRfQ09OVEVYVF9LRVlXT1JEID0gIm1jaWRfcHJpbWFyeV9kZWNyeXB0ZWQgZXF1YWxzIjsKCiAgY29uc3Qgc2xlZXAgPSAobXMpID0+IG5ldyBQcm9taXNlKChyKSA9PiBzZXRUaW1lb3V0KHIsIG1zKSk7CiAgY29uc3Qgbm9ybSA9IChzKSA9PiAocyB8fCAiIikudG9Mb3dlckNhc2UoKS5yZXBsYWNlKC9bXHMuXy1dKy9nLCAiIik7CgogIGZ1bmN0aW9uIGlzVmlzaWJsZShlbCkgewogICAgaWYgKCFlbCkgcmV0dXJuIGZhbHNlOwogICAgY29uc3QgcmVjdCA9IGVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwogICAgY29uc3Qgc3R5bGUgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShlbCk7CiAgICByZXR1cm4gcmVjdC53aWR0aCA+IDAgJiYgcmVjdC5oZWlnaHQgPiAwICYmIHN0eWxlLnZpc2liaWxpdHkgIT09ICJoaWRkZW4iICYmIHN0eWxlLmRpc3BsYXkgIT09ICJub25lIjsKICB9CgogIGZ1bmN0aW9uIGdldFJvb3RzKGRvYykgewogICAgY29uc3Qgcm9vdHMgPSBbZG9jXTsKICAgIGZvciAoY29uc3QgZiBvZiBkb2MucXVlcnlTZWxlY3RvckFsbCgiaWZyYW1lIikpIHsKICAgICAgdHJ5IHsKICAgICAgICBpZiAoZi5jb250ZW50RG9jdW1lbnQpIHJvb3RzLnB1c2goLi4uZ2V0Um9vdHMoZi5jb250ZW50RG9jdW1lbnQpKTsKICAgICAgfSBjYXRjaCAoXykgewogICAgICAgIC8vIGNyb3NzLW9yaWdpbiBpZnJhbWUgaWdub3JlZAogICAgICB9CiAgICB9CiAgICByZXR1cm4gcm9vdHM7CiAgfQoKICBmdW5jdGlvbiBxdWVyeUFsbERlZXAocm9vdCwgc2VsZWN0b3IpIHsKICAgIGNvbnN0IG91dCA9IFtdOwogICAgY29uc3Qgd2FsayA9IChyKSA9PiB7CiAgICAgIG91dC5wdXNoKC4uLnIucXVlcnlTZWxlY3RvckFsbChzZWxlY3RvcikpOwogICAgICBjb25zdCBhbGwgPSByLnF1ZXJ5U2VsZWN0b3JBbGwoIioiKTsKICAgICAgZm9yIChjb25zdCBlbCBvZiBhbGwpIGlmIChlbC5zaGFkb3dSb290KSB3YWxrKGVsLnNoYWRvd1Jvb3QpOwogICAgfTsKICAgIHdhbGsocm9vdCk7CiAgICByZXR1cm4gb3V0OwogIH0KCiAgZnVuY3Rpb24gcGlja0Ryb3Bkb3duKCkgewogICAgY29uc3Qgcm9vdHMgPSBnZXRSb290cyhkb2N1bWVudCk7CiAgICBjb25zdCBleGFjdFNlbGVjdG9ycyA9IFsKICAgICAgJ1tyb2xlPSJjb21ib2JveCJdW2RhdGEtYXV0b21hdGlvbi1pZD0ic2hlZXRfY29udHJvbF9zZWFyY2hfcmVzdWx0c19kcm9wZG93biJdW2RhdGEtYXV0b21hdGlvbi1jb250ZXh0PSJtY2lkIHByaW1hcnlfZGVjcnlwdGVkIGVxdWFscyJdJywKICAgICAgJ1tyb2xlPSJjb21ib2JveCJdW2RhdGEtYXV0b21hdGlvbi1pZD0ic2hlZXQgY29udHJvbCBzZWFyY2ggcmVzdWx0cyBkcm9wZG93biJdW2RhdGEtYXV0b21hdGlvbi1jb250ZXh0PSJtY2lkIHByaW1hcnkgZGVjcnlwdGVkIGVxdWFscyJdJywKICAgICAgJ1tyb2xlPSJjb21ib2JveCJdW2RhdGEtYXV0b21hdGlvbi1pZD0ic2hlZXRfY29udHJvbF9zZWFyY2hfcmVzdWx0c19kcm9wZG93biJdJywKICAgICAgJ1tyb2xlPSJjb21ib2JveCJdW2RhdGEtYXV0b21hdGlvbi1pZD0ic2hlZXQgY29udHJvbCBzZWFyY2ggcmVzdWx0cyBkcm9wZG93biJdJywKICAgIF07CiAgICBmb3IgKGNvbnN0IHJvb3Qgb2Ygcm9vdHMpIHsKICAgICAgZm9yIChjb25zdCBzZWxlY3RvciBvZiBleGFjdFNlbGVjdG9ycykgewogICAgICAgIGNvbnN0IGhpdCA9IHF1ZXJ5QWxsRGVlcChyb290LCBzZWxlY3RvcikuZmluZCgoZWwpID0+IGlzVmlzaWJsZShlbCkpOwogICAgICAgIGlmIChoaXQpIHJldHVybiBoaXQ7CiAgICAgIH0KICAgIH0KCiAgICBsZXQgYmVzdCA9IG51bGw7CiAgICBsZXQgYmVzdFNjb3JlID0gLTFlOTsKICAgIGZvciAoY29uc3Qgcm9vdCBvZiByb290cykgewogICAgICBjb25zdCBjYW5kcyA9IHF1ZXJ5QWxsRGVlcCgKICAgICAgICByb290LAogICAgICAgICdbcm9sZT0iY29tYm9ib3giXSwgW2RhdGEtYXV0b21hdGlvbi1pZCo9InNlYXJjaF9yZXN1bHRzX2Ryb3Bkb3duIl0sIFtkYXRhLWF1dG9tYXRpb24taWQqPSJzZWFyY2ggcmVzdWx0cyBkcm9wZG93biJdJwogICAgICApOwogICAgICBmb3IgKGNvbnN0IGVsIG9mIGNhbmRzKSB7CiAgICAgICAgY29uc3QgdGV4dCA9IFsKICAgICAgICAgIGVsLmdldEF0dHJpYnV0ZSgiZGF0YS1hdXRvbWF0aW9uLWlkIiksCiAgICAgICAgICBlbC5nZXRBdHRyaWJ1dGUoImRhdGEtYXV0b21hdGlvbi1jb250ZXh0IiksCiAgICAgICAgICBlbC5nZXRBdHRyaWJ1dGUoImFyaWEtbGFiZWwiKSwKICAgICAgICAgIGVsLmdldEF0dHJpYnV0ZSgidGl0bGUiKSwKICAgICAgICAgIGVsLnRleHRDb250ZW50LAogICAgICAgIF0KICAgICAgICAgIC5maWx0ZXIoQm9vbGVhbikKICAgICAgICAgIC5qb2luKCIgIik7CiAgICAgICAgY29uc3QgbiA9IG5vcm0odGV4dCk7CiAgICAgICAgbGV0IHNjb3JlID0gMDsKICAgICAgICBpZiAobi5pbmNsdWRlcygic2VhcmNocmVzdWx0c2Ryb3Bkb3duIikpIHNjb3JlICs9IDg7CiAgICAgICAgaWYgKG4uaW5jbHVkZXMobm9ybShUQVJHRVRfQ09OVEVYVF9LRVlXT1JEKSkpIHNjb3JlICs9IDU7CiAgICAgICAgaWYgKG4uaW5jbHVkZXMoIm1jaWRwcmltYXJ5ZGVjcnlwdGVkZXF1YWxzIikpIHNjb3JlICs9IDU7CiAgICAgICAgaWYgKG4uaW5jbHVkZXMoImFsbCIpKSBzY29yZSArPSAxOwogICAgICAgIGlmICgoZWwuZ2V0QXR0cmlidXRlKCJhcmlhLWhhc3BvcHVwIikgfHwgIiIpLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoImxpc3Rib3giKSkgc2NvcmUgKz0gMTsKICAgICAgICBpZiAoIWlzVmlzaWJsZShlbCkpIHNjb3JlIC09IDEwMDsKICAgICAgICBpZiAoc2NvcmUgPiBiZXN0U2NvcmUpIHsKICAgICAgICAgIGJlc3RTY29yZSA9IHNjb3JlOwogICAgICAgICAgYmVzdCA9IGVsOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIGJlc3RTY29yZSA+PSA0ID8gYmVzdCA6IG51bGw7CiAgfQoKICBhc3luYyBmdW5jdGlvbiBnZXRJZFZhbHVlKCkgewogICAgY29uc3QgY2xlYW4gPSAodikgPT4KICAgICAgU3RyaW5nKHYgfHwgIiIpCiAgICAgICAgLnJlcGxhY2UoL1x1MDBhMC9nLCAiICIpCiAgICAgICAgLnJlcGxhY2UoL1tcclxuXHRdL2csICIiKQogICAgICAgIC50cmltKCk7CgogICAgaWYgKFNPVVJDRV9JTlBVVF9TRUxFQ1RPUikgewogICAgICBjb25zdCBzcmMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFNPVVJDRV9JTlBVVF9TRUxFQ1RPUik7CiAgICAgIGlmICghc3JjKSB0aHJvdyBuZXcgRXJyb3IoYOaJvuS4jeWIsOadpea6kOaWh+acrOahhjogJHtTT1VSQ0VfSU5QVVRfU0VMRUNUT1J9YCk7CiAgICAgIGNvbnN0IHYgPSAidmFsdWUiIGluIHNyYyA/IHNyYy52YWx1ZSA6IHNyYy50ZXh0Q29udGVudDsKICAgICAgY29uc3Qgb3V0ID0gY2xlYW4odik7CiAgICAgIGlmICghb3V0KSB0aHJvdyBuZXcgRXJyb3IoIuadpea6kOaWh+acrOahhuS4uuepuu+8jOivt+WFiOi+k+WFpSBJROOAgiIpOwogICAgICByZXR1cm4gb3V0OwogICAgfQogICAgLy8g5LyY5YWI6K+75Y+W57O757uf5Ymq6LS05p2/77yI6ZyA6KaB5Zyo55So5oi35omL5Yq/5ZCOL+WuieWFqOS4iuS4i+aWh+S4reWFgeiuuO+8ieOAggogICAgdHJ5IHsKICAgICAgaWYgKG5hdmlnYXRvci5jbGlwYm9hcmQ/LnJlYWRUZXh0KSB7CiAgICAgICAgY29uc3QgY2xpcCA9IGNsZWFuKGF3YWl0IG5hdmlnYXRvci5jbGlwYm9hcmQucmVhZFRleHQoKSk7CiAgICAgICAgaWYgKGNsaXApIHJldHVybiBjbGlwOwogICAgICB9CiAgICB9IGNhdGNoIChfKSB7CiAgICAgIC8vIGlnbm9yZSBhbmQgZmFsbGJhY2sgdG8gcHJvbXB0CiAgICB9CgogICAgY29uc3QgdiA9IHdpbmRvdy5wcm9tcHQoIuivt+i+k+WFpeimgeaQnOe0oueahCBJRO+8iOWPr+ebtOaOpeeymOi0tO+8iToiLCAiIik7CiAgICBjb25zdCBvdXQgPSBjbGVhbih2KTsKICAgIGlmICghb3V0KSB0aHJvdyBuZXcgRXJyb3IoIuacqui+k+WFpSBJRO+8jOW3suWPlua2iOOAgiIpOwogICAgcmV0dXJuIG91dDsKICB9CgogIGZ1bmN0aW9uIG9wZW5Ecm9wZG93bldpdGhNb3VzZVNlcXVlbmNlKGVsKSB7CiAgICBjb25zdCBldmVudHMgPSBbInBvaW50ZXJkb3duIiwgIm1vdXNlZG93biIsICJwb2ludGVydXAiLCAibW91c2V1cCIsICJjbGljayJdOwogICAgZm9yIChjb25zdCB0eXBlIG9mIGV2ZW50cykgewogICAgICBlbC5kaXNwYXRjaEV2ZW50KG5ldyBNb3VzZUV2ZW50KHR5cGUsIHsgYnViYmxlczogdHJ1ZSwgY2FuY2VsYWJsZTogdHJ1ZSwgdmlldzogd2luZG93IH0pKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGNlbnRlck9mKGVsKSB7CiAgICBjb25zdCByID0gZWwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICByZXR1cm4geyB4OiByLmxlZnQgKyByLndpZHRoIC8gMiwgeTogci50b3AgKyByLmhlaWdodCAvIDIgfTsKICB9CgogIGZ1bmN0aW9uIGRpc3RhbmNlKGEsIGIpIHsKICAgIGNvbnN0IGR4ID0gYS54IC0gYi54OwogICAgY29uc3QgZHkgPSBhLnkgLSBiLnk7CiAgICByZXR1cm4gTWF0aC5zcXJ0KGR4ICogZHggKyBkeSAqIGR5KTsKICB9CgogIGZ1bmN0aW9uIHBpY2tCZXN0U2VhcmNoSW5wdXQoaW5wdXRzLCBkcm9wZG93bikgewogICAgaWYgKCFpbnB1dHMubGVuZ3RoKSByZXR1cm4gbnVsbDsKICAgIGNvbnN0IGRyb3Bkb3duQ2VudGVyID0gY2VudGVyT2YoZHJvcGRvd24pOwogICAgbGV0IGJlc3QgPSBudWxsOwogICAgbGV0IGJlc3RTY29yZSA9IC1JbmZpbml0eTsKICAgIGZvciAoY29uc3QgZWwgb2YgaW5wdXRzKSB7CiAgICAgIGNvbnN0IHAgPSBub3JtKGVsLmdldEF0dHJpYnV0ZSgicGxhY2Vob2xkZXIiKSk7CiAgICAgIGNvbnN0IGEgPSBub3JtKGVsLmdldEF0dHJpYnV0ZSgiYXJpYS1sYWJlbCIpKTsKICAgICAgY29uc3QgZXhhY3QgPSBwID09PSAic2VhcmNodmFsdWUiIHx8IGEgPT09ICJzZWFyY2h2YWx1ZSI7CiAgICAgIGNvbnN0IHNjb3JlQnlUZXh0ID0gZXhhY3QgPyAxMDAgOiAxMDsKICAgICAgY29uc3Qgc2NvcmVCeURpc3RhbmNlID0gLWRpc3RhbmNlKGNlbnRlck9mKGVsKSwgZHJvcGRvd25DZW50ZXIpOwogICAgICBjb25zdCBzY29yZSA9IHNjb3JlQnlUZXh0ICsgc2NvcmVCeURpc3RhbmNlOwogICAgICBpZiAoc2NvcmUgPiBiZXN0U2NvcmUpIHsKICAgICAgICBiZXN0U2NvcmUgPSBzY29yZTsKICAgICAgICBiZXN0ID0gZWw7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBiZXN0OwogIH0KCiAgYXN5bmMgZnVuY3Rpb24gd2FpdFNlYXJjaElucHV0KGRyb3Bkb3duLCB0aW1lb3V0TXMgPSA4MDAwKSB7CiAgICBjb25zdCBzdGFydCA9IERhdGUubm93KCk7CiAgICB3aGlsZSAoRGF0ZS5ub3coKSAtIHN0YXJ0IDwgdGltZW91dE1zKSB7CiAgICAgIGNvbnN0IGFsbFZpc2libGVJbnB1dHMgPSBbXTsKICAgICAgZm9yIChjb25zdCByb290IG9mIGdldFJvb3RzKGRvY3VtZW50KSkgewogICAgICAgIGNvbnN0IGlucHV0cyA9IHF1ZXJ5QWxsRGVlcChyb290LCAnaW5wdXRbcGxhY2Vob2xkZXI9IlNlYXJjaCB2YWx1ZSJdLCBpbnB1dFthcmlhLWxhYmVsPSJTZWFyY2ggdmFsdWUiXSwgaW5wdXRbdHlwZT0idGV4dCJdJyk7CiAgICAgICAgYWxsVmlzaWJsZUlucHV0cy5wdXNoKC4uLmlucHV0cy5maWx0ZXIoKGVsKSA9PiBpc1Zpc2libGUoZWwpICYmICFlbC5kaXNhYmxlZCkpOwogICAgICB9CiAgICAgIGNvbnN0IHRhcmdldCA9IHBpY2tCZXN0U2VhcmNoSW5wdXQoYWxsVmlzaWJsZUlucHV0cywgZHJvcGRvd24pOwogICAgICBpZiAodGFyZ2V0KSByZXR1cm4gdGFyZ2V0OwogICAgICBhd2FpdCBzbGVlcCgxMjApOwogICAgfQogICAgcmV0dXJuIG51bGw7CiAgfQoKICBhc3luYyBmdW5jdGlvbiB0eXBlSW50b0F1dG9jb21wbGV0ZShpbnB1dCwgdmFsdWUpIHsKICAgIGNvbnN0IG5hdGl2ZVNldHRlciA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoCiAgICAgIHdpbmRvdy5IVE1MSW5wdXRFbGVtZW50LnByb3RvdHlwZSwKICAgICAgInZhbHVlIgogICAgKT8uc2V0OwogICAgY29uc3Qgc2V0VmFsdWUgPSAodikgPT4gewogICAgICBpZiAobmF0aXZlU2V0dGVyKSBuYXRpdmVTZXR0ZXIuY2FsbChpbnB1dCwgdik7CiAgICAgIGVsc2UgaW5wdXQudmFsdWUgPSB2OwogICAgfTsKCiAgICBpbnB1dC5mb2N1cygpOwogICAgaW5wdXQuY2xpY2soKTsKICAgIGF3YWl0IHNsZWVwKDYwKTsKCiAgICAvLyDmuIXnqbrml6flgLwKICAgIHNldFZhbHVlKCIiKTsKICAgIGlucHV0LmRpc3BhdGNoRXZlbnQobmV3IElucHV0RXZlbnQoImlucHV0IiwgeyBidWJibGVzOiB0cnVlLCBpbnB1dFR5cGU6ICJkZWxldGVDb250ZW50QmFja3dhcmQiLCBkYXRhOiBudWxsIH0pKTsKICAgIGF3YWl0IHNsZWVwKDQwKTsKCiAgICAvLyDpgJDlrZfnrKbovpPlhaXvvIzop6blj5EgTVVJIEF1dG9jb21wbGV0ZSDnmoTlhoXpg6jnm5HlkKwKICAgIGxldCBjdXJyZW50ID0gIiI7CiAgICBmb3IgKGNvbnN0IGNoIG9mIFN0cmluZyh2YWx1ZSkpIHsKICAgICAgY3VycmVudCArPSBjaDsKICAgICAgaW5wdXQuZGlzcGF0Y2hFdmVudChuZXcgS2V5Ym9hcmRFdmVudCgia2V5ZG93biIsIHsga2V5OiBjaCwgYnViYmxlczogdHJ1ZSB9KSk7CiAgICAgIHNldFZhbHVlKGN1cnJlbnQpOwogICAgICBpbnB1dC5kaXNwYXRjaEV2ZW50KG5ldyBJbnB1dEV2ZW50KCJpbnB1dCIsIHsgYnViYmxlczogdHJ1ZSwgaW5wdXRUeXBlOiAiaW5zZXJ0VGV4dCIsIGRhdGE6IGNoIH0pKTsKICAgICAgaW5wdXQuZGlzcGF0Y2hFdmVudChuZXcgS2V5Ym9hcmRFdmVudCgia2V5dXAiLCB7IGtleTogY2gsIGJ1YmJsZXM6IHRydWUgfSkpOwogICAgICBhd2FpdCBzbGVlcCgyNSk7CiAgICB9CgogICAgLy8g5LiN6Kem5Y+RIGJsdXIvQXJyb3dEb3du77yM6YG/5YWN57uE5Lu25bCG5b2T5YmN6L6T5YWl5Yik5a6a5Li65pyq56Gu6K6k5bm25riF56m644CCCiAgfQoKICBmdW5jdGlvbiBmaW5kUGFuZWxSb290KHNlYXJjaElucHV0LCBkcm9wZG93bikgewogICAgY29uc3QgZnJvbUlucHV0ID0gc2VhcmNoSW5wdXQ/LmNsb3Nlc3QoCiAgICAgICcuTXVpUG9wb3Zlci1wYXBlciwgLk11aU1lbnUtcGFwZXIsIC5NdWlQYXBlci1yb290LCBbcm9sZT0iZGlhbG9nIl0sIFtyb2xlPSJwcmVzZW50YXRpb24iXScKICAgICk7CiAgICBpZiAoZnJvbUlucHV0KSByZXR1cm4gZnJvbUlucHV0OwoKICAgIGNvbnN0IGZyb21Ecm9wZG93biA9IGRyb3Bkb3duPy5jbG9zZXN0KAogICAgICAnLk11aVBvcG92ZXItcGFwZXIsIC5NdWlNZW51LXBhcGVyLCAuTXVpUGFwZXItcm9vdCwgW3JvbGU9ImRpYWxvZyJdLCBbcm9sZT0icHJlc2VudGF0aW9uIl0nCiAgICApOwogICAgaWYgKGZyb21Ecm9wZG93bikgcmV0dXJuIGZyb21Ecm9wZG93bjsKCiAgICByZXR1cm4gZG9jdW1lbnQ7CiAgfQoKICBmdW5jdGlvbiBmaW5kU2VhcmNoQnV0dG9uSW5QYW5lbChzY29wZVJvb3QpIHsKICAgIGlmICh3aW5kb3cualF1ZXJ5KSB7CiAgICAgIGNvbnN0ICQgPSB3aW5kb3cualF1ZXJ5OwogICAgICBjb25zdCAkYnRuID0gJChzY29wZVJvb3QpCiAgICAgICAgLmZpbmQoJ2J1dHRvbltkYXRhLWF1dG9tYXRpb24taWQqPSJzZWFyY2giXSwgYnV0dG9uJykKICAgICAgICAuZmlsdGVyKChfLCBlbCkgPT4gbm9ybSgkKGVsKS50ZXh0KCkpID09PSAic2VhcmNoIiB8fCBub3JtKCQoZWwpLnRleHQoKSkuZW5kc1dpdGgoInNlYXJjaCIpKQogICAgICAgIC5maXJzdCgpOwogICAgICBpZiAoJGJ0bi5sZW5ndGggJiYgaXNWaXNpYmxlKCRidG5bMF0pKSByZXR1cm4gJGJ0blswXTsKICAgIH0KCiAgICBjb25zdCBidG5zID0gcXVlcnlBbGxEZWVwKHNjb3BlUm9vdCwgJ2J1dHRvbiwgW3JvbGU9ImJ1dHRvbiJdJyk7CiAgICByZXR1cm4gYnRucy5maW5kKChlbCkgPT4gewogICAgICBpZiAoIWlzVmlzaWJsZShlbCkpIHJldHVybiBmYWxzZTsKICAgICAgY29uc3QgdCA9IG5vcm0oCiAgICAgICAgWwogICAgICAgICAgZWwuZ2V0QXR0cmlidXRlKCJkYXRhLWF1dG9tYXRpb24taWQiKSwKICAgICAgICAgIGVsLmdldEF0dHJpYnV0ZSgiYXJpYS1sYWJlbCIpLAogICAgICAgICAgZWwuZ2V0QXR0cmlidXRlKCJ0aXRsZSIpLAogICAgICAgICAgZWwudGV4dENvbnRlbnQsCiAgICAgICAgXQogICAgICAgICAgLmZpbHRlcihCb29sZWFuKQogICAgICAgICAgLmpvaW4oIiAiKQogICAgICApOwogICAgICByZXR1cm4gdC5pbmNsdWRlcygicGFnaW5hdGVkc2VhcmNoY29tcG9uZW50c2VhcmNoIikgfHwgdCA9PT0gInNlYXJjaCIgfHwgdC5lbmRzV2l0aCgic2VhcmNoIik7CiAgICB9KSB8fCBudWxsOwogIH0KCiAgYXN5bmMgZnVuY3Rpb24gd2FpdFNlYXJjaEJ1dHRvbihzY29wZVJvb3QsIHRpbWVvdXRNcyA9IDgwMDApIHsKICAgIGNvbnN0IHN0YXJ0ID0gRGF0ZS5ub3coKTsKICAgIHdoaWxlIChEYXRlLm5vdygpIC0gc3RhcnQgPCB0aW1lb3V0TXMpIHsKICAgICAgY29uc3QgYnRuID0gZmluZFNlYXJjaEJ1dHRvbkluUGFuZWwoc2NvcGVSb290KTsKICAgICAgaWYgKGJ0bikgcmV0dXJuIGJ0bjsKICAgICAgYXdhaXQgc2xlZXAoMTIwKTsKICAgIH0KICAgIHJldHVybiBudWxsOwogIH0KCiAgZnVuY3Rpb24gZmluZE1pbmltaXplQnV0dG9uKCkgewogICAgY29uc3QgYnlBdXRvbWF0aW9uSWQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKAogICAgICAnYnV0dG9uW2RhdGEtYXV0b21hdGlvbi1pZD0iYW5hbHlzaXNfdmlzdWFsX2Ryb3Bkb3duX21pbmltaXplIl0nCiAgICApOwogICAgaWYgKGJ5QXV0b21hdGlvbklkICYmIGlzVmlzaWJsZShieUF1dG9tYXRpb25JZCkpIHJldHVybiBieUF1dG9tYXRpb25JZDsKCiAgICBjb25zdCBjYW5kaWRhdGVzID0gcXVlcnlBbGxEZWVwKGRvY3VtZW50LCAnYnV0dG9uLCBbcm9sZT0iYnV0dG9uIl0nKTsKICAgIGZvciAoY29uc3QgZWwgb2YgY2FuZGlkYXRlcykgewogICAgICBpZiAoIWlzVmlzaWJsZShlbCkpIGNvbnRpbnVlOwogICAgICBjb25zdCB0ID0gbm9ybSgKICAgICAgICBbCiAgICAgICAgICBlbC5nZXRBdHRyaWJ1dGUoImRhdGEtYXV0b21hdGlvbi1pZCIpLAogICAgICAgICAgZWwuZ2V0QXR0cmlidXRlKCJhcmlhLWxhYmVsIiksCiAgICAgICAgICBlbC5nZXRBdHRyaWJ1dGUoInRpdGxlIiksCiAgICAgICAgICBlbC50ZXh0Q29udGVudCwKICAgICAgICBdCiAgICAgICAgICAuZmlsdGVyKEJvb2xlYW4pCiAgICAgICAgICAuam9pbigiICIpCiAgICAgICk7CiAgICAgIGlmICh0LmluY2x1ZGVzKCJhbmFseXNpc3Zpc3VhbGRyb3Bkb3dubWluaW1pemUiKSB8fCB0LmluY2x1ZGVzKCJtaW5pbWl6ZSIpKSB7CiAgICAgICAgcmV0dXJuIGVsOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gbnVsbDsKICB9CgogIGFzeW5jIGZ1bmN0aW9uIHdhaXRNaW5pbWl6ZUJ1dHRvbih0aW1lb3V0TXMgPSA4MDAwKSB7CiAgICBjb25zdCBzdGFydCA9IERhdGUubm93KCk7CiAgICB3aGlsZSAoRGF0ZS5ub3coKSAtIHN0YXJ0IDwgdGltZW91dE1zKSB7CiAgICAgIGNvbnN0IGJ0biA9IGZpbmRNaW5pbWl6ZUJ1dHRvbigpOwogICAgICBpZiAoYnRuKSByZXR1cm4gYnRuOwogICAgICBhd2FpdCBzbGVlcCgxMjApOwogICAgfQogICAgcmV0dXJuIG51bGw7CiAgfQoKICBmdW5jdGlvbiBmaW5kU2VsZWN0QWxsSW5QYW5lbChzY29wZVJvb3QpIHsKICAgIGNvbnN0IGJ5SWQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgib3B0aW9uLXNlbGVjdC1hbGwiKTsKICAgIGlmIChieUlkICYmIGlzVmlzaWJsZShieUlkKSkgcmV0dXJuIGJ5SWQ7CgogICAgaWYgKHdpbmRvdy5qUXVlcnkpIHsKICAgICAgY29uc3QgJCA9IHdpbmRvdy5qUXVlcnk7CiAgICAgIGNvbnN0ICRieUlkID0gJCgiI29wdGlvbi1zZWxlY3QtYWxsIik7CiAgICAgIGlmICgkYnlJZC5sZW5ndGggJiYgaXNWaXNpYmxlKCRieUlkWzBdKSkgcmV0dXJuICRieUlkWzBdOwoKICAgICAgY29uc3QgJGhpdCA9ICQoc2NvcGVSb290KQogICAgICAgIC5maW5kKCdbcm9sZT0ib3B0aW9uIl0sIGxpLCBkaXYsIHNwYW4sIGxhYmVsJykKICAgICAgICAuZmlsdGVyKChfLCBlbCkgPT4gL3NlbGVjdCBhbGwgcmVzdWx0cy9pLnRlc3QoJChlbCkudGV4dCgpKSkKICAgICAgICAuZmlyc3QoKTsKICAgICAgaWYgKCRoaXQubGVuZ3RoKSByZXR1cm4gJGhpdFswXS5jbG9zZXN0KCdbcm9sZT0ib3B0aW9uIl0sIGxpLCBkaXYsIGxhYmVsJykgfHwgJGhpdFswXTsKICAgIH0KCiAgICBjb25zdCBjYW5kaWRhdGVzID0gcXVlcnlBbGxEZWVwKHNjb3BlUm9vdCwgJ1tyb2xlPSJvcHRpb24iXSwgbGksIGRpdiwgc3BhbiwgbGFiZWwnKTsKICAgIGZvciAoY29uc3QgZWwgb2YgY2FuZGlkYXRlcykgewogICAgICBpZiAoIWlzVmlzaWJsZShlbCkpIGNvbnRpbnVlOwogICAgICBpZiAoL3NlbGVjdCBhbGwgcmVzdWx0cy9pLnRlc3QoKGVsLnRleHRDb250ZW50IHx8ICIiKS50cmltKCkpKSB7CiAgICAgICAgcmV0dXJuIGVsLmNsb3Nlc3QoJ1tyb2xlPSJvcHRpb24iXSwgbGksIGRpdiwgbGFiZWwnKSB8fCBlbDsKICAgICAgfQogICAgfQogICAgcmV0dXJuIG51bGw7CiAgfQoKICBjb25zdCBpZFZhbHVlID0gYXdhaXQgZ2V0SWRWYWx1ZSgpOwogIGNvbnN0IGRyb3Bkb3duID0gcGlja0Ryb3Bkb3duKCk7CiAgaWYgKCFkcm9wZG93bikgdGhyb3cgbmV3IEVycm9yKCLmib7kuI3liLDkuIvmi4nmjInpkq7vvIhBbGwg5Y+z5L6n5LiJ6KeS77yJ44CCIik7CgogIC8vIOWbuuWumueUqOS9oOmqjOivgeacieaViOeahOaWueW8jzLvvJptb3VzZSBzZXF1ZW5jZeOAggogIG9wZW5Ecm9wZG93bldpdGhNb3VzZVNlcXVlbmNlKGRyb3Bkb3duKTsKICBhd2FpdCBzbGVlcCgyMjApOwoKICBsZXQgc2VhcmNoSW5wdXQgPSBhd2FpdCB3YWl0U2VhcmNoSW5wdXQoZHJvcGRvd24sIDEyMDApOwogIGlmICghc2VhcmNoSW5wdXQpIHsKICAgIC8vIOWFnOW6leWGjeinpuWPkeS4gOasoe+8jOWkhOeQhuWBtuWPkemmluasoeacquWxleW8gOOAggogICAgb3BlbkRyb3Bkb3duV2l0aE1vdXNlU2VxdWVuY2UoZHJvcGRvd24pOwogICAgYXdhaXQgc2xlZXAoMjIwKTsKICAgIHNlYXJjaElucHV0ID0gYXdhaXQgd2FpdFNlYXJjaElucHV0KGRyb3Bkb3duLCAxMDAwMCk7CiAgfQogIGlmICghc2VhcmNoSW5wdXQpIHRocm93IG5ldyBFcnJvcigi5LiL5ouJ5bey54K55Ye777yM5L2G5om+5LiN5YiwIFNlYXJjaCB2YWx1ZSDovpPlhaXmoYbjgIIiKTsKCiAgc2VhcmNoSW5wdXQuZm9jdXMoKTsKICBhd2FpdCB0eXBlSW50b0F1dG9jb21wbGV0ZShzZWFyY2hJbnB1dCwgaWRWYWx1ZSk7CiAgaWYgKCFzZWFyY2hJbnB1dC5pc0Nvbm5lY3RlZCB8fCAhaXNWaXNpYmxlKHNlYXJjaElucHV0KSkgewogICAgLy8g6L6T5YWl6L+H56iL5Lit6Z2i5p2/6KKr5YWz6Zet5pe277yM6YeN5paw5bGV5byA5YaN6L6T5YWl5LiA5qyh44CCCiAgICBvcGVuRHJvcGRvd25XaXRoTW91c2VTZXF1ZW5jZShkcm9wZG93bik7CiAgICBhd2FpdCBzbGVlcCgyMjApOwogICAgc2VhcmNoSW5wdXQgPSBhd2FpdCB3YWl0U2VhcmNoSW5wdXQoZHJvcGRvd24sIDMwMDApOwogICAgaWYgKCFzZWFyY2hJbnB1dCkgdGhyb3cgbmV3IEVycm9yKCLovpPlhaXlkI7pnaLmnb/lhbPpl63vvIzkuJTml6Dms5Xph43mlrDlrprkvY0gU2VhcmNoIHZhbHVlIOi+k+WFpeahhuOAgiIpOwogICAgYXdhaXQgdHlwZUludG9BdXRvY29tcGxldGUoc2VhcmNoSW5wdXQsIGlkVmFsdWUpOwogIH0KICBpZiAoKHNlYXJjaElucHV0LnZhbHVlIHx8ICIiKS50cmltKCkgIT09IGlkVmFsdWUpIHsKICAgIHRocm93IG5ldyBFcnJvcihgSUQg5pyq5oiQ5Yqf5YaZ5YWl5pCc57Si5qGG44CC5b2T5YmN5YC8OiAiJHtzZWFyY2hJbnB1dC52YWx1ZSB8fCAiIn0iYCk7CiAgfQogIGF3YWl0IHNsZWVwKDI1MCk7CgogIGNvbnN0IHBhbmVsUm9vdCA9IGZpbmRQYW5lbFJvb3Qoc2VhcmNoSW5wdXQsIGRyb3Bkb3duKTsKICBjb25zdCBzZWFyY2hCdG4gPSBhd2FpdCB3YWl0U2VhcmNoQnV0dG9uKHBhbmVsUm9vdCwgMTAwMDApOwogIGlmICghc2VhcmNoQnRuKSB0aHJvdyBuZXcgRXJyb3IoIuW3suWhq+WFpSBJRO+8jOS9huaJvuS4jeWIsCBTZWFyY2gg5oyJ6ZKu44CCIik7CgogIHNlYXJjaEJ0bi5jbGljaygpOwogIGF3YWl0IHNsZWVwKDIwMDApOwoKICBjb25zdCBzZWxlY3RBbGwgPSBmaW5kU2VsZWN0QWxsSW5QYW5lbChwYW5lbFJvb3QpOwogIGlmICghc2VsZWN0QWxsKSB0aHJvdyBuZXcgRXJyb3IoIlNlYXJjaCDlt7Lngrnlh7vvvIzkvYbmib7kuI3liLAgU2VsZWN0IGFsbCByZXN1bHRz44CCIik7CiAgc2VsZWN0QWxsLmNsaWNrKCk7CgogIGF3YWl0IHNsZWVwKDI1MCk7CiAgY29uc3QgbWluaW1pemVCdG4gPSBhd2FpdCB3YWl0TWluaW1pemVCdXR0b24oMTAwMDApOwogIGlmICghbWluaW1pemVCdG4pIHRocm93IG5ldyBFcnJvcigi5bey5a6M5oiQIFNlbGVjdCBhbGwgcmVzdWx0c++8jOS9huaJvuS4jeWIsCBNaW5pbWl6ZSDmjInpkq7jgIIiKTsKICBtaW5pbWl6ZUJ0bi5jbGljaygpOwoKICBjb25zb2xlLmxvZygi5a6M5oiQ77ya5bey5aGr5YWlIElE77yM54K55Ye7IFNlYXJjaO+8jOWLvumAiSBTZWxlY3QgYWxsIHJlc3VsdHPvvIzlubbngrnlh7sgTWluaW1pemXjgIIiLCB7IGlkVmFsdWUgfSk7Cn0pKCk7Cg=="));})();