javascript:(()=>{localStorage.setItem('rrf_v1',"/**\n * Combined workflow on current QuickSight page:\n * 1) click-reset.js logic\n * 2) wait 1s\n * 3) fill-id-and-search.js logic (as-is)\n */\n(async () => {\n  async function runClickReset() {\n    const TARGET_FIELD = \"mcid_primary_decrypted equals\";\n    const EXACT_MENU_BUTTON_SELECTOR = [\n      'button[data-automation-id=\"sheet control menu button\"][data-automation-context=\"mcid_primary_decrypted equals\"]',\n      'button[data-automation-id=\"sheet.control.menu.button\"][data-automation-context=\"mcid_primary_decrypted equals\"]',\n      'button[data-automation-id=\"sheet control menubutton\"][data-automation-context=\"mcid_primary_decrypted equals\"]',\n    ].join(\", \");\n\n    const sleep = (ms) => new Promise((resolve) => setTimeout(resolve, ms));\n    const norm = (s) => (s || \"\").toLowerCase().replace(/[\\s._-]+/g, \"\");\n\n    function isVisible(el) {\n      if (!el) return false;\n      const rect = el.getBoundingClientRect();\n      const style = window.getComputedStyle(el);\n      return rect.width > 0 && rect.height > 0 && style.visibility !== \"hidden\" && style.display !== \"none\";\n    }\n\n    function collectRoots(startDocument) {\n      const roots = [startDocument];\n      for (const frame of startDocument.querySelectorAll(\"iframe\")) {\n        try {\n          if (frame.contentDocument) roots.push(...collectRoots(frame.contentDocument));\n        } catch (_) {}\n      }\n      return roots;\n    }\n\n    function collectInteractiveCandidates(root) {\n      const result = [];\n      const walk = (nodeRoot) => {\n        const candidates = nodeRoot.querySelectorAll('button, [role=\"button\"], [aria-haspopup=\"true\"], [role=\"menuitem\"], li[role=\"menuitem\"]');\n        for (const el of candidates) result.push(el);\n        const all = nodeRoot.querySelectorAll(\"*\");\n        for (const el of all) {\n          if (el.shadowRoot) walk(el.shadowRoot);\n        }\n      };\n      walk(root);\n      return result;\n    }\n\n    function openWithMouseSequence(el) {\n      const events = [\"pointerdown\", \"mousedown\", \"pointerup\", \"mouseup\", \"click\"];\n      for (const type of events) {\n        el.dispatchEvent(new MouseEvent(type, { bubbles: true, cancelable: true, view: window }));\n      }\n    }\n\n    function scoreMenuButton(el) {\n      const attrs = [\n        el.getAttribute(\"data-automation-id\"),\n        el.getAttribute(\"data-automation-context\"),\n        el.getAttribute(\"aria-label\"),\n        el.getAttribute(\"title\"),\n        el.textContent,\n      ]\n        .filter(Boolean)\n        .join(\" \");\n      const n = norm(attrs);\n      const field = norm(TARGET_FIELD);\n      let score = 0;\n      if (n.includes(\"sheetcontrolmenubutton\")) score += 5;\n      if (n.includes(\"options\")) score += 3;\n      if (n.includes(field)) score += 4;\n      if (n.includes(\"mcidprimarydecryptedequals\")) score += 4;\n      if ((el.getAttribute(\"aria-haspopup\") || \"\").toLowerCase() === \"true\") score += 1;\n      if (el.tagName.toLowerCase() === \"button\") score += 1;\n      if (!isVisible(el)) score -= 100;\n      return score;\n    }\n\n    function findBestMenuButton() {\n      const roots = collectRoots(document);\n      for (const root of roots) {\n        const exact = root.querySelector(EXACT_MENU_BUTTON_SELECTOR);\n        if (exact && isVisible(exact)) return exact;\n      }\n\n      let best = null;\n      let bestScore = -Infinity;\n      for (const root of roots) {\n        const candidates = collectInteractiveCandidates(root);\n        for (const el of candidates) {\n          const score = scoreMenuButton(el);\n          if (score > bestScore) {\n            best = el;\n            bestScore = score;\n          }\n        }\n      }\n      return bestScore >= 4 ? best : null;\n    }\n\n    async function waitForMenuButton(timeoutMs = 8000) {\n      const start = Date.now();\n      while (Date.now() - start < timeoutMs) {\n        const el = findBestMenuButton();\n        if (el) return el;\n        await sleep(100);\n      }\n      return null;\n    }\n\n    function isResetItem(el, openedMenusOnly) {\n      if (!el) return false;\n      if (!isVisible(el)) return false;\n      const automationId = norm(el.getAttribute(\"data-automation-id\"));\n      const text = norm((el.textContent || \"\").trim());\n      if (openedMenusOnly) {\n        const menuContainer = el.closest('[role=\"menu\"], .MuiMenu-paper, .MuiPopover-paper');\n        if (!menuContainer || !isVisible(menuContainer)) return false;\n      }\n      return automationId.includes(\"reset\") || text === \"reset\" || text.includes(\"reset\");\n    }\n\n    async function findResetItem(timeoutMs = 8000) {\n      const start = Date.now();\n      while (Date.now() - start < timeoutMs) {\n        const roots = collectRoots(document);\n        const candidates = [];\n        for (const root of roots) {\n          candidates.push(...collectInteractiveCandidates(root));\n        }\n        const resetInOpenMenu = candidates.find((el) => isResetItem(el, true));\n        if (resetInOpenMenu) return resetInOpenMenu;\n        const anyReset = candidates.find((el) => isResetItem(el, false));\n        if (anyReset) return anyReset;\n        await sleep(100);\n      }\n      return null;\n    }\n\n    const menuButton = await waitForMenuButton(10000);\n    if (!menuButton) throw new Error(\"找不到三点菜单按钮。\");\n    openWithMouseSequence(menuButton);\n    await sleep(250);\n    const resetItem = await findResetItem(8000);\n    if (!resetItem) throw new Error(\"点击了三点菜单，但没找到 Reset 选项。\");\n    resetItem.click();\n  }\n\n  async function runFillIdAndSearch() {\n    const SOURCE_INPUT_SELECTOR = \"\";\n    const TARGET_CONTEXT_KEYWORD = \"mcid_primary_decrypted equals\";\n\n    const sleep = (ms) => new Promise((r) => setTimeout(r, ms));\n    const norm = (s) => (s || \"\").toLowerCase().replace(/[\\s._-]+/g, \"\");\n\n    function isVisible(el) {\n      if (!el) return false;\n      const rect = el.getBoundingClientRect();\n      const style = window.getComputedStyle(el);\n      return rect.width > 0 && rect.height > 0 && style.visibility !== \"hidden\" && style.display !== \"none\";\n    }\n\n    function getRoots(doc) {\n      const roots = [doc];\n      for (const f of doc.querySelectorAll(\"iframe\")) {\n        try {\n          if (f.contentDocument) roots.push(...getRoots(f.contentDocument));\n        } catch (_) {}\n      }\n      return roots;\n    }\n\n    function queryAllDeep(root, selector) {\n      const out = [];\n      const walk = (r) => {\n        out.push(...r.querySelectorAll(selector));\n        const all = r.querySelectorAll(\"*\");\n        for (const el of all) if (el.shadowRoot) walk(el.shadowRoot);\n      };\n      walk(root);\n      return out;\n    }\n\n    function pickDropdown() {\n      const roots = getRoots(document);\n      const exactSelectors = [\n        '[role=\"combobox\"][data-automation-id=\"sheet_control_search_results_dropdown\"][data-automation-context=\"mcid primary_decrypted equals\"]',\n        '[role=\"combobox\"][data-automation-id=\"sheet control search results dropdown\"][data-automation-context=\"mcid primary decrypted equals\"]',\n        '[role=\"combobox\"][data-automation-id=\"sheet_control_search_results_dropdown\"]',\n        '[role=\"combobox\"][data-automation-id=\"sheet control search results dropdown\"]',\n      ];\n      for (const root of roots) {\n        for (const selector of exactSelectors) {\n          const hit = queryAllDeep(root, selector).find((el) => isVisible(el));\n          if (hit) return hit;\n        }\n      }\n\n      let best = null;\n      let bestScore = -1e9;\n      for (const root of roots) {\n        const cands = queryAllDeep(\n          root,\n          '[role=\"combobox\"], [data-automation-id*=\"search_results_dropdown\"], [data-automation-id*=\"search results dropdown\"]'\n        );\n        for (const el of cands) {\n          const text = [\n            el.getAttribute(\"data-automation-id\"),\n            el.getAttribute(\"data-automation-context\"),\n            el.getAttribute(\"aria-label\"),\n            el.getAttribute(\"title\"),\n            el.textContent,\n          ]\n            .filter(Boolean)\n            .join(\" \");\n          const n = norm(text);\n          let score = 0;\n          if (n.includes(\"searchresultsdropdown\")) score += 8;\n          if (n.includes(norm(TARGET_CONTEXT_KEYWORD))) score += 5;\n          if (n.includes(\"mcidprimarydecryptedequals\")) score += 5;\n          if (n.includes(\"all\")) score += 1;\n          if ((el.getAttribute(\"aria-haspopup\") || \"\").toLowerCase().includes(\"listbox\")) score += 1;\n          if (!isVisible(el)) score -= 100;\n          if (score > bestScore) {\n            bestScore = score;\n            best = el;\n          }\n        }\n      }\n      return bestScore >= 4 ? best : null;\n    }\n\n    async function getIdValue() {\n      const clean = (v) =>\n        String(v || \"\")\n          .replace(/\\u00a0/g, \" \")\n          .replace(/[\\r\\n\\t]/g, \"\")\n          .trim();\n\n      if (SOURCE_INPUT_SELECTOR) {\n        const src = document.querySelector(SOURCE_INPUT_SELECTOR);\n        if (!src) throw new Error(`找不到来源文本框: ${SOURCE_INPUT_SELECTOR}`);\n        const v = \"value\" in src ? src.value : src.textContent;\n        const out = clean(v);\n        if (!out) throw new Error(\"来源文本框为空，请先输入 ID。\");\n        return out;\n      }\n      try {\n        if (navigator.clipboard?.readText) {\n          const clip = clean(await navigator.clipboard.readText());\n          if (clip) return clip;\n        }\n      } catch (_) {}\n\n      const v = window.prompt(\"请输入要搜索的 ID（可直接粘贴）:\", \"\");\n      const out = clean(v);\n      if (!out) throw new Error(\"未输入 ID，已取消。\");\n      return out;\n    }\n\n    function openDropdownWithMouseSequence(el) {\n      const events = [\"pointerdown\", \"mousedown\", \"pointerup\", \"mouseup\", \"click\"];\n      for (const type of events) {\n        el.dispatchEvent(new MouseEvent(type, { bubbles: true, cancelable: true, view: window }));\n      }\n    }\n\n    function centerOf(el) {\n      const r = el.getBoundingClientRect();\n      return { x: r.left + r.width / 2, y: r.top + r.height / 2 };\n    }\n\n    function distance(a, b) {\n      const dx = a.x - b.x;\n      const dy = a.y - b.y;\n      return Math.sqrt(dx * dx + dy * dy);\n    }\n\n    function pickBestSearchInput(inputs, dropdown) {\n      if (!inputs.length) return null;\n      const dropdownCenter = centerOf(dropdown);\n      let best = null;\n      let bestScore = -Infinity;\n      for (const el of inputs) {\n        const p = norm(el.getAttribute(\"placeholder\"));\n        const a = norm(el.getAttribute(\"aria-label\"));\n        const exact = p === \"searchvalue\" || a === \"searchvalue\";\n        const scoreByText = exact ? 100 : 10;\n        const scoreByDistance = -distance(centerOf(el), dropdownCenter);\n        const score = scoreByText + scoreByDistance;\n        if (score > bestScore) {\n          bestScore = score;\n          best = el;\n        }\n      }\n      return best;\n    }\n\n    async function waitSearchInput(dropdown, timeoutMs = 8000) {\n      const start = Date.now();\n      while (Date.now() - start < timeoutMs) {\n        const allVisibleInputs = [];\n        for (const root of getRoots(document)) {\n          const inputs = queryAllDeep(root, 'input[placeholder=\"Search value\"], input[aria-label=\"Search value\"], input[type=\"text\"]');\n          allVisibleInputs.push(...inputs.filter((el) => isVisible(el) && !el.disabled));\n        }\n        const target = pickBestSearchInput(allVisibleInputs, dropdown);\n        if (target) return target;\n        await sleep(120);\n      }\n      return null;\n    }\n\n    async function typeIntoAutocomplete(input, value) {\n      const nativeSetter = Object.getOwnPropertyDescriptor(\n        window.HTMLInputElement.prototype,\n        \"value\"\n      )?.set;\n      const setValue = (v) => {\n        if (nativeSetter) nativeSetter.call(input, v);\n        else input.value = v;\n      };\n\n      input.focus();\n      input.click();\n      await sleep(60);\n\n      setValue(\"\");\n      input.dispatchEvent(new InputEvent(\"input\", { bubbles: true, inputType: \"deleteContentBackward\", data: null }));\n      await sleep(40);\n\n      let current = \"\";\n      for (const ch of String(value)) {\n        current += ch;\n        input.dispatchEvent(new KeyboardEvent(\"keydown\", { key: ch, bubbles: true }));\n        setValue(current);\n        input.dispatchEvent(new InputEvent(\"input\", { bubbles: true, inputType: \"insertText\", data: ch }));\n        input.dispatchEvent(new KeyboardEvent(\"keyup\", { key: ch, bubbles: true }));\n        await sleep(25);\n      }\n    }\n\n    function findPanelRoot(searchInput, dropdown) {\n      const fromInput = searchInput?.closest(\n        '.MuiPopover-paper, .MuiMenu-paper, .MuiPaper-root, [role=\"dialog\"], [role=\"presentation\"]'\n      );\n      if (fromInput) return fromInput;\n\n      const fromDropdown = dropdown?.closest(\n        '.MuiPopover-paper, .MuiMenu-paper, .MuiPaper-root, [role=\"dialog\"], [role=\"presentation\"]'\n      );\n      if (fromDropdown) return fromDropdown;\n\n      return document;\n    }\n\n    function findSearchButtonInPanel(scopeRoot) {\n      if (window.jQuery) {\n        const $ = window.jQuery;\n        const $btn = $(scopeRoot)\n          .find('button[data-automation-id*=\"search\"], button')\n          .filter((_, el) => norm($(el).text()) === \"search\" || norm($(el).text()).endsWith(\"search\"))\n          .first();\n        if ($btn.length && isVisible($btn[0])) return $btn[0];\n      }\n\n      const btns = queryAllDeep(scopeRoot, 'button, [role=\"button\"]');\n      return btns.find((el) => {\n        if (!isVisible(el)) return false;\n        const t = norm(\n          [\n            el.getAttribute(\"data-automation-id\"),\n            el.getAttribute(\"aria-label\"),\n            el.getAttribute(\"title\"),\n            el.textContent,\n          ]\n            .filter(Boolean)\n            .join(\" \")\n        );\n        return t.includes(\"paginatedsearchcomponentsearch\") || t === \"search\" || t.endsWith(\"search\");\n      }) || null;\n    }\n\n    async function waitSearchButton(scopeRoot, timeoutMs = 8000) {\n      const start = Date.now();\n      while (Date.now() - start < timeoutMs) {\n        const btn = findSearchButtonInPanel(scopeRoot);\n        if (btn) return btn;\n        await sleep(120);\n      }\n      return null;\n    }\n\n    function findMinimizeButton() {\n      const byAutomationId = document.querySelector(\n        'button[data-automation-id=\"analysis_visual_dropdown_minimize\"]'\n      );\n      if (byAutomationId && isVisible(byAutomationId)) return byAutomationId;\n      const byAutomationIdWithSpace = document.querySelector(\n        'button[data-automation-id=\"analysis_visual dropdown_minimize\"]'\n      );\n      if (byAutomationIdWithSpace && isVisible(byAutomationIdWithSpace)) return byAutomationIdWithSpace;\n\n      const candidates = queryAllDeep(document, 'button, [role=\"button\"]');\n      for (const el of candidates) {\n        if (!isVisible(el)) continue;\n        const t = norm(\n          [\n            el.getAttribute(\"data-automation-id\"),\n            el.getAttribute(\"aria-label\"),\n            el.getAttribute(\"title\"),\n            el.textContent,\n          ]\n            .filter(Boolean)\n            .join(\" \")\n        );\n        if (t.includes(\"analysisvisualdropdownminimize\") || t.includes(\"minimize\")) {\n          return el;\n        }\n      }\n      return null;\n    }\n\n    function findAdditionalMinimizeButton() {\n      const selectors = [\n        'button[data-automation-id=\"analysis_visual dropdown_minimize\"]',\n        'button[title=\"Minimize\"][aria-label*=\"Related sellers\"]',\n        'button[aria-label*=\"Minimize\"][aria-label*=\"Related sellers\"]',\n      ];\n      for (const selector of selectors) {\n        const el = document.querySelector(selector);\n        if (el && isVisible(el)) return el;\n      }\n      return null;\n    }\n\n    async function waitMinimizeButton(timeoutMs = 8000) {\n      const start = Date.now();\n      while (Date.now() - start < timeoutMs) {\n        const btn = findMinimizeButton();\n        if (btn) return btn;\n        await sleep(120);\n      }\n      return null;\n    }\n\n    function findSelectAllInPanel(scopeRoot) {\n      const byId = document.getElementById(\"option-select-all\");\n      if (byId && isVisible(byId)) return byId;\n\n      if (window.jQuery) {\n        const $ = window.jQuery;\n        const $byId = $(\"#option-select-all\");\n        if ($byId.length && isVisible($byId[0])) return $byId[0];\n\n        const $hit = $(scopeRoot)\n          .find('[role=\"option\"], li, div, span, label')\n          .filter((_, el) => /select all results/i.test($(el).text()))\n          .first();\n        if ($hit.length) return $hit[0].closest('[role=\"option\"], li, div, label') || $hit[0];\n      }\n\n      const candidates = queryAllDeep(scopeRoot, '[role=\"option\"], li, div, span, label');\n      for (const el of candidates) {\n        if (!isVisible(el)) continue;\n        if (/select all results/i.test((el.textContent || \"\").trim())) {\n          return el.closest('[role=\"option\"], li, div, label') || el;\n        }\n      }\n      return null;\n    }\n\n    const idValue = await getIdValue();\n    const dropdown = pickDropdown();\n    if (!dropdown) throw new Error(\"找不到下拉按钮（All 右侧三角）。\");\n\n    openDropdownWithMouseSequence(dropdown);\n    await sleep(220);\n\n    let searchInput = await waitSearchInput(dropdown, 1200);\n    if (!searchInput) {\n      openDropdownWithMouseSequence(dropdown);\n      await sleep(220);\n      searchInput = await waitSearchInput(dropdown, 10000);\n    }\n    if (!searchInput) throw new Error(\"下拉已点击，但找不到 Search value 输入框。\");\n\n    searchInput.focus();\n    await typeIntoAutocomplete(searchInput, idValue);\n    if (!searchInput.isConnected || !isVisible(searchInput)) {\n      openDropdownWithMouseSequence(dropdown);\n      await sleep(220);\n      searchInput = await waitSearchInput(dropdown, 3000);\n      if (!searchInput) throw new Error(\"输入后面板关闭，且无法重新定位 Search value 输入框。\");\n      await typeIntoAutocomplete(searchInput, idValue);\n    }\n    if ((searchInput.value || \"\").trim() !== idValue) {\n      throw new Error(`ID 未成功写入搜索框。当前值: \"${searchInput.value || \"\"}\"`);\n    }\n    await sleep(250);\n\n    const panelRoot = findPanelRoot(searchInput, dropdown);\n    const searchBtn = await waitSearchButton(panelRoot, 10000);\n    if (!searchBtn) throw new Error(\"已填入 ID，但找不到 Search 按钮。\");\n\n    searchBtn.click();\n    await sleep(2000);\n\n    const selectAll = findSelectAllInPanel(panelRoot);\n    if (!selectAll) throw new Error(\"Search 已点击，但找不到 Select all results。\");\n    selectAll.click();\n\n    await sleep(250);\n    const minimizeBtn = await waitMinimizeButton(10000);\n    if (!minimizeBtn) throw new Error(\"已完成 Select all results，但找不到 Minimize 按钮。\");\n    minimizeBtn.click();\n    await sleep(200);\n\n    const extraMinimizeBtn = findAdditionalMinimizeButton();\n    if (extraMinimizeBtn) extraMinimizeBtn.click();\n  }\n\n  const sleep = (ms) => new Promise((r) => setTimeout(r, ms));\n  await runClickReset();\n  await sleep(1000);\n  await runFillIdAndSearch();\n  console.log(\"完成：已执行 click-reset + fill-id-and-search。\");\n})();\n");alert('Workflow installed: rrf_v1');})();