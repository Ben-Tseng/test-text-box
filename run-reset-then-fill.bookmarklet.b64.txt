javascript:(()=>{(0,eval)(atob("LyoqCiAqIENvbWJpbmVkIHdvcmtmbG93IG9uIGN1cnJlbnQgUXVpY2tTaWdodCBwYWdlOgogKiAxKSBjbGljay1yZXNldC5qcyBsb2dpYwogKiAyKSB3YWl0IDFzCiAqIDMpIGZpbGwtaWQtYW5kLXNlYXJjaC5qcyBsb2dpYyAoYXMtaXMpCiAqLwooYXN5bmMgKCkgPT4gewogIGFzeW5jIGZ1bmN0aW9uIHJ1bkNsaWNrUmVzZXQoKSB7CiAgICBjb25zdCBUQVJHRVRfRklFTEQgPSAibWNpZF9wcmltYXJ5X2RlY3J5cHRlZCBlcXVhbHMiOwogICAgY29uc3QgRVhBQ1RfTUVOVV9CVVRUT05fU0VMRUNUT1IgPSBbCiAgICAgICdidXR0b25bZGF0YS1hdXRvbWF0aW9uLWlkPSJzaGVldCBjb250cm9sIG1lbnUgYnV0dG9uIl1bZGF0YS1hdXRvbWF0aW9uLWNvbnRleHQ9Im1jaWRfcHJpbWFyeV9kZWNyeXB0ZWQgZXF1YWxzIl0nLAogICAgICAnYnV0dG9uW2RhdGEtYXV0b21hdGlvbi1pZD0ic2hlZXQuY29udHJvbC5tZW51LmJ1dHRvbiJdW2RhdGEtYXV0b21hdGlvbi1jb250ZXh0PSJtY2lkX3ByaW1hcnlfZGVjcnlwdGVkIGVxdWFscyJdJywKICAgICAgJ2J1dHRvbltkYXRhLWF1dG9tYXRpb24taWQ9InNoZWV0IGNvbnRyb2wgbWVudWJ1dHRvbiJdW2RhdGEtYXV0b21hdGlvbi1jb250ZXh0PSJtY2lkX3ByaW1hcnlfZGVjcnlwdGVkIGVxdWFscyJdJywKICAgIF0uam9pbigiLCAiKTsKCiAgICBjb25zdCBzbGVlcCA9IChtcykgPT4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgbXMpKTsKICAgIGNvbnN0IG5vcm0gPSAocykgPT4gKHMgfHwgIiIpLnRvTG93ZXJDYXNlKCkucmVwbGFjZSgvW1xzLl8tXSsvZywgIiIpOwoKICAgIGZ1bmN0aW9uIGlzVmlzaWJsZShlbCkgewogICAgICBpZiAoIWVsKSByZXR1cm4gZmFsc2U7CiAgICAgIGNvbnN0IHJlY3QgPSBlbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgICAgY29uc3Qgc3R5bGUgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShlbCk7CiAgICAgIHJldHVybiByZWN0LndpZHRoID4gMCAmJiByZWN0LmhlaWdodCA+IDAgJiYgc3R5bGUudmlzaWJpbGl0eSAhPT0gImhpZGRlbiIgJiYgc3R5bGUuZGlzcGxheSAhPT0gIm5vbmUiOwogICAgfQoKICAgIGZ1bmN0aW9uIGNvbGxlY3RSb290cyhzdGFydERvY3VtZW50KSB7CiAgICAgIGNvbnN0IHJvb3RzID0gW3N0YXJ0RG9jdW1lbnRdOwogICAgICBmb3IgKGNvbnN0IGZyYW1lIG9mIHN0YXJ0RG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiaWZyYW1lIikpIHsKICAgICAgICB0cnkgewogICAgICAgICAgaWYgKGZyYW1lLmNvbnRlbnREb2N1bWVudCkgcm9vdHMucHVzaCguLi5jb2xsZWN0Um9vdHMoZnJhbWUuY29udGVudERvY3VtZW50KSk7CiAgICAgICAgfSBjYXRjaCAoXykge30KICAgICAgfQogICAgICByZXR1cm4gcm9vdHM7CiAgICB9CgogICAgZnVuY3Rpb24gY29sbGVjdEludGVyYWN0aXZlQ2FuZGlkYXRlcyhyb290KSB7CiAgICAgIGNvbnN0IHJlc3VsdCA9IFtdOwogICAgICBjb25zdCB3YWxrID0gKG5vZGVSb290KSA9PiB7CiAgICAgICAgY29uc3QgY2FuZGlkYXRlcyA9IG5vZGVSb290LnF1ZXJ5U2VsZWN0b3JBbGwoJ2J1dHRvbiwgW3JvbGU9ImJ1dHRvbiJdLCBbYXJpYS1oYXNwb3B1cD0idHJ1ZSJdLCBbcm9sZT0ibWVudWl0ZW0iXSwgbGlbcm9sZT0ibWVudWl0ZW0iXScpOwogICAgICAgIGZvciAoY29uc3QgZWwgb2YgY2FuZGlkYXRlcykgcmVzdWx0LnB1c2goZWwpOwogICAgICAgIGNvbnN0IGFsbCA9IG5vZGVSb290LnF1ZXJ5U2VsZWN0b3JBbGwoIioiKTsKICAgICAgICBmb3IgKGNvbnN0IGVsIG9mIGFsbCkgewogICAgICAgICAgaWYgKGVsLnNoYWRvd1Jvb3QpIHdhbGsoZWwuc2hhZG93Um9vdCk7CiAgICAgICAgfQogICAgICB9OwogICAgICB3YWxrKHJvb3QpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQoKICAgIGZ1bmN0aW9uIG9wZW5XaXRoTW91c2VTZXF1ZW5jZShlbCkgewogICAgICBjb25zdCBldmVudHMgPSBbInBvaW50ZXJkb3duIiwgIm1vdXNlZG93biIsICJwb2ludGVydXAiLCAibW91c2V1cCIsICJjbGljayJdOwogICAgICBmb3IgKGNvbnN0IHR5cGUgb2YgZXZlbnRzKSB7CiAgICAgICAgZWwuZGlzcGF0Y2hFdmVudChuZXcgTW91c2VFdmVudCh0eXBlLCB7IGJ1YmJsZXM6IHRydWUsIGNhbmNlbGFibGU6IHRydWUsIHZpZXc6IHdpbmRvdyB9KSk7CiAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBzY29yZU1lbnVCdXR0b24oZWwpIHsKICAgICAgY29uc3QgYXR0cnMgPSBbCiAgICAgICAgZWwuZ2V0QXR0cmlidXRlKCJkYXRhLWF1dG9tYXRpb24taWQiKSwKICAgICAgICBlbC5nZXRBdHRyaWJ1dGUoImRhdGEtYXV0b21hdGlvbi1jb250ZXh0IiksCiAgICAgICAgZWwuZ2V0QXR0cmlidXRlKCJhcmlhLWxhYmVsIiksCiAgICAgICAgZWwuZ2V0QXR0cmlidXRlKCJ0aXRsZSIpLAogICAgICAgIGVsLnRleHRDb250ZW50LAogICAgICBdCiAgICAgICAgLmZpbHRlcihCb29sZWFuKQogICAgICAgIC5qb2luKCIgIik7CiAgICAgIGNvbnN0IG4gPSBub3JtKGF0dHJzKTsKICAgICAgY29uc3QgZmllbGQgPSBub3JtKFRBUkdFVF9GSUVMRCk7CiAgICAgIGxldCBzY29yZSA9IDA7CiAgICAgIGlmIChuLmluY2x1ZGVzKCJzaGVldGNvbnRyb2xtZW51YnV0dG9uIikpIHNjb3JlICs9IDU7CiAgICAgIGlmIChuLmluY2x1ZGVzKCJvcHRpb25zIikpIHNjb3JlICs9IDM7CiAgICAgIGlmIChuLmluY2x1ZGVzKGZpZWxkKSkgc2NvcmUgKz0gNDsKICAgICAgaWYgKG4uaW5jbHVkZXMoIm1jaWRwcmltYXJ5ZGVjcnlwdGVkZXF1YWxzIikpIHNjb3JlICs9IDQ7CiAgICAgIGlmICgoZWwuZ2V0QXR0cmlidXRlKCJhcmlhLWhhc3BvcHVwIikgfHwgIiIpLnRvTG93ZXJDYXNlKCkgPT09ICJ0cnVlIikgc2NvcmUgKz0gMTsKICAgICAgaWYgKGVsLnRhZ05hbWUudG9Mb3dlckNhc2UoKSA9PT0gImJ1dHRvbiIpIHNjb3JlICs9IDE7CiAgICAgIGlmICghaXNWaXNpYmxlKGVsKSkgc2NvcmUgLT0gMTAwOwogICAgICByZXR1cm4gc2NvcmU7CiAgICB9CgogICAgZnVuY3Rpb24gZmluZEJlc3RNZW51QnV0dG9uKCkgewogICAgICBjb25zdCByb290cyA9IGNvbGxlY3RSb290cyhkb2N1bWVudCk7CiAgICAgIGZvciAoY29uc3Qgcm9vdCBvZiByb290cykgewogICAgICAgIGNvbnN0IGV4YWN0ID0gcm9vdC5xdWVyeVNlbGVjdG9yKEVYQUNUX01FTlVfQlVUVE9OX1NFTEVDVE9SKTsKICAgICAgICBpZiAoZXhhY3QgJiYgaXNWaXNpYmxlKGV4YWN0KSkgcmV0dXJuIGV4YWN0OwogICAgICB9CgogICAgICBsZXQgYmVzdCA9IG51bGw7CiAgICAgIGxldCBiZXN0U2NvcmUgPSAtSW5maW5pdHk7CiAgICAgIGZvciAoY29uc3Qgcm9vdCBvZiByb290cykgewogICAgICAgIGNvbnN0IGNhbmRpZGF0ZXMgPSBjb2xsZWN0SW50ZXJhY3RpdmVDYW5kaWRhdGVzKHJvb3QpOwogICAgICAgIGZvciAoY29uc3QgZWwgb2YgY2FuZGlkYXRlcykgewogICAgICAgICAgY29uc3Qgc2NvcmUgPSBzY29yZU1lbnVCdXR0b24oZWwpOwogICAgICAgICAgaWYgKHNjb3JlID4gYmVzdFNjb3JlKSB7CiAgICAgICAgICAgIGJlc3QgPSBlbDsKICAgICAgICAgICAgYmVzdFNjb3JlID0gc2NvcmU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBiZXN0U2NvcmUgPj0gNCA/IGJlc3QgOiBudWxsOwogICAgfQoKICAgIGFzeW5jIGZ1bmN0aW9uIHdhaXRGb3JNZW51QnV0dG9uKHRpbWVvdXRNcyA9IDgwMDApIHsKICAgICAgY29uc3Qgc3RhcnQgPSBEYXRlLm5vdygpOwogICAgICB3aGlsZSAoRGF0ZS5ub3coKSAtIHN0YXJ0IDwgdGltZW91dE1zKSB7CiAgICAgICAgY29uc3QgZWwgPSBmaW5kQmVzdE1lbnVCdXR0b24oKTsKICAgICAgICBpZiAoZWwpIHJldHVybiBlbDsKICAgICAgICBhd2FpdCBzbGVlcCgxMDApOwogICAgICB9CiAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIGZ1bmN0aW9uIGlzUmVzZXRJdGVtKGVsLCBvcGVuZWRNZW51c09ubHkpIHsKICAgICAgaWYgKCFlbCkgcmV0dXJuIGZhbHNlOwogICAgICBpZiAoIWlzVmlzaWJsZShlbCkpIHJldHVybiBmYWxzZTsKICAgICAgY29uc3QgYXV0b21hdGlvbklkID0gbm9ybShlbC5nZXRBdHRyaWJ1dGUoImRhdGEtYXV0b21hdGlvbi1pZCIpKTsKICAgICAgY29uc3QgdGV4dCA9IG5vcm0oKGVsLnRleHRDb250ZW50IHx8ICIiKS50cmltKCkpOwogICAgICBpZiAob3BlbmVkTWVudXNPbmx5KSB7CiAgICAgICAgY29uc3QgbWVudUNvbnRhaW5lciA9IGVsLmNsb3Nlc3QoJ1tyb2xlPSJtZW51Il0sIC5NdWlNZW51LXBhcGVyLCAuTXVpUG9wb3Zlci1wYXBlcicpOwogICAgICAgIGlmICghbWVudUNvbnRhaW5lciB8fCAhaXNWaXNpYmxlKG1lbnVDb250YWluZXIpKSByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgcmV0dXJuIGF1dG9tYXRpb25JZC5pbmNsdWRlcygicmVzZXQiKSB8fCB0ZXh0ID09PSAicmVzZXQiIHx8IHRleHQuaW5jbHVkZXMoInJlc2V0Iik7CiAgICB9CgogICAgYXN5bmMgZnVuY3Rpb24gZmluZFJlc2V0SXRlbSh0aW1lb3V0TXMgPSA4MDAwKSB7CiAgICAgIGNvbnN0IHN0YXJ0ID0gRGF0ZS5ub3coKTsKICAgICAgd2hpbGUgKERhdGUubm93KCkgLSBzdGFydCA8IHRpbWVvdXRNcykgewogICAgICAgIGNvbnN0IHJvb3RzID0gY29sbGVjdFJvb3RzKGRvY3VtZW50KTsKICAgICAgICBjb25zdCBjYW5kaWRhdGVzID0gW107CiAgICAgICAgZm9yIChjb25zdCByb290IG9mIHJvb3RzKSB7CiAgICAgICAgICBjYW5kaWRhdGVzLnB1c2goLi4uY29sbGVjdEludGVyYWN0aXZlQ2FuZGlkYXRlcyhyb290KSk7CiAgICAgICAgfQogICAgICAgIGNvbnN0IHJlc2V0SW5PcGVuTWVudSA9IGNhbmRpZGF0ZXMuZmluZCgoZWwpID0+IGlzUmVzZXRJdGVtKGVsLCB0cnVlKSk7CiAgICAgICAgaWYgKHJlc2V0SW5PcGVuTWVudSkgcmV0dXJuIHJlc2V0SW5PcGVuTWVudTsKICAgICAgICBjb25zdCBhbnlSZXNldCA9IGNhbmRpZGF0ZXMuZmluZCgoZWwpID0+IGlzUmVzZXRJdGVtKGVsLCBmYWxzZSkpOwogICAgICAgIGlmIChhbnlSZXNldCkgcmV0dXJuIGFueVJlc2V0OwogICAgICAgIGF3YWl0IHNsZWVwKDEwMCk7CiAgICAgIH0KICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgY29uc3QgbWVudUJ1dHRvbiA9IGF3YWl0IHdhaXRGb3JNZW51QnV0dG9uKDEwMDAwKTsKICAgIGlmICghbWVudUJ1dHRvbikgdGhyb3cgbmV3IEVycm9yKCLmib7kuI3liLDkuInngrnoj5zljZXmjInpkq7jgIIiKTsKICAgIG9wZW5XaXRoTW91c2VTZXF1ZW5jZShtZW51QnV0dG9uKTsKICAgIGF3YWl0IHNsZWVwKDI1MCk7CiAgICBjb25zdCByZXNldEl0ZW0gPSBhd2FpdCBmaW5kUmVzZXRJdGVtKDgwMDApOwogICAgaWYgKCFyZXNldEl0ZW0pIHRocm93IG5ldyBFcnJvcigi54K55Ye75LqG5LiJ54K56I+c5Y2V77yM5L2G5rKh5om+5YiwIFJlc2V0IOmAiemhueOAgiIpOwogICAgcmVzZXRJdGVtLmNsaWNrKCk7CiAgfQoKICBhc3luYyBmdW5jdGlvbiBydW5GaWxsSWRBbmRTZWFyY2goKSB7CiAgICBjb25zdCBTT1VSQ0VfSU5QVVRfU0VMRUNUT1IgPSAiIjsKICAgIGNvbnN0IFRBUkdFVF9DT05URVhUX0tFWVdPUkQgPSAibWNpZF9wcmltYXJ5X2RlY3J5cHRlZCBlcXVhbHMiOwoKICAgIGNvbnN0IHNsZWVwID0gKG1zKSA9PiBuZXcgUHJvbWlzZSgocikgPT4gc2V0VGltZW91dChyLCBtcykpOwogICAgY29uc3Qgbm9ybSA9IChzKSA9PiAocyB8fCAiIikudG9Mb3dlckNhc2UoKS5yZXBsYWNlKC9bXHMuXy1dKy9nLCAiIik7CgogICAgZnVuY3Rpb24gaXNWaXNpYmxlKGVsKSB7CiAgICAgIGlmICghZWwpIHJldHVybiBmYWxzZTsKICAgICAgY29uc3QgcmVjdCA9IGVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwogICAgICBjb25zdCBzdHlsZSA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGVsKTsKICAgICAgcmV0dXJuIHJlY3Qud2lkdGggPiAwICYmIHJlY3QuaGVpZ2h0ID4gMCAmJiBzdHlsZS52aXNpYmlsaXR5ICE9PSAiaGlkZGVuIiAmJiBzdHlsZS5kaXNwbGF5ICE9PSAibm9uZSI7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0Um9vdHMoZG9jKSB7CiAgICAgIGNvbnN0IHJvb3RzID0gW2RvY107CiAgICAgIGZvciAoY29uc3QgZiBvZiBkb2MucXVlcnlTZWxlY3RvckFsbCgiaWZyYW1lIikpIHsKICAgICAgICB0cnkgewogICAgICAgICAgaWYgKGYuY29udGVudERvY3VtZW50KSByb290cy5wdXNoKC4uLmdldFJvb3RzKGYuY29udGVudERvY3VtZW50KSk7CiAgICAgICAgfSBjYXRjaCAoXykge30KICAgICAgfQogICAgICByZXR1cm4gcm9vdHM7CiAgICB9CgogICAgZnVuY3Rpb24gcXVlcnlBbGxEZWVwKHJvb3QsIHNlbGVjdG9yKSB7CiAgICAgIGNvbnN0IG91dCA9IFtdOwogICAgICBjb25zdCB3YWxrID0gKHIpID0+IHsKICAgICAgICBvdXQucHVzaCguLi5yLnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3IpKTsKICAgICAgICBjb25zdCBhbGwgPSByLnF1ZXJ5U2VsZWN0b3JBbGwoIioiKTsKICAgICAgICBmb3IgKGNvbnN0IGVsIG9mIGFsbCkgaWYgKGVsLnNoYWRvd1Jvb3QpIHdhbGsoZWwuc2hhZG93Um9vdCk7CiAgICAgIH07CiAgICAgIHdhbGsocm9vdCk7CiAgICAgIHJldHVybiBvdXQ7CiAgICB9CgogICAgZnVuY3Rpb24gcGlja0Ryb3Bkb3duKCkgewogICAgICBjb25zdCByb290cyA9IGdldFJvb3RzKGRvY3VtZW50KTsKICAgICAgY29uc3QgZXhhY3RTZWxlY3RvcnMgPSBbCiAgICAgICAgJ1tyb2xlPSJjb21ib2JveCJdW2RhdGEtYXV0b21hdGlvbi1pZD0ic2hlZXRfY29udHJvbF9zZWFyY2hfcmVzdWx0c19kcm9wZG93biJdW2RhdGEtYXV0b21hdGlvbi1jb250ZXh0PSJtY2lkIHByaW1hcnlfZGVjcnlwdGVkIGVxdWFscyJdJywKICAgICAgICAnW3JvbGU9ImNvbWJvYm94Il1bZGF0YS1hdXRvbWF0aW9uLWlkPSJzaGVldCBjb250cm9sIHNlYXJjaCByZXN1bHRzIGRyb3Bkb3duIl1bZGF0YS1hdXRvbWF0aW9uLWNvbnRleHQ9Im1jaWQgcHJpbWFyeSBkZWNyeXB0ZWQgZXF1YWxzIl0nLAogICAgICAgICdbcm9sZT0iY29tYm9ib3giXVtkYXRhLWF1dG9tYXRpb24taWQ9InNoZWV0X2NvbnRyb2xfc2VhcmNoX3Jlc3VsdHNfZHJvcGRvd24iXScsCiAgICAgICAgJ1tyb2xlPSJjb21ib2JveCJdW2RhdGEtYXV0b21hdGlvbi1pZD0ic2hlZXQgY29udHJvbCBzZWFyY2ggcmVzdWx0cyBkcm9wZG93biJdJywKICAgICAgXTsKICAgICAgZm9yIChjb25zdCByb290IG9mIHJvb3RzKSB7CiAgICAgICAgZm9yIChjb25zdCBzZWxlY3RvciBvZiBleGFjdFNlbGVjdG9ycykgewogICAgICAgICAgY29uc3QgaGl0ID0gcXVlcnlBbGxEZWVwKHJvb3QsIHNlbGVjdG9yKS5maW5kKChlbCkgPT4gaXNWaXNpYmxlKGVsKSk7CiAgICAgICAgICBpZiAoaGl0KSByZXR1cm4gaGl0OwogICAgICAgIH0KICAgICAgfQoKICAgICAgbGV0IGJlc3QgPSBudWxsOwogICAgICBsZXQgYmVzdFNjb3JlID0gLTFlOTsKICAgICAgZm9yIChjb25zdCByb290IG9mIHJvb3RzKSB7CiAgICAgICAgY29uc3QgY2FuZHMgPSBxdWVyeUFsbERlZXAoCiAgICAgICAgICByb290LAogICAgICAgICAgJ1tyb2xlPSJjb21ib2JveCJdLCBbZGF0YS1hdXRvbWF0aW9uLWlkKj0ic2VhcmNoX3Jlc3VsdHNfZHJvcGRvd24iXSwgW2RhdGEtYXV0b21hdGlvbi1pZCo9InNlYXJjaCByZXN1bHRzIGRyb3Bkb3duIl0nCiAgICAgICAgKTsKICAgICAgICBmb3IgKGNvbnN0IGVsIG9mIGNhbmRzKSB7CiAgICAgICAgICBjb25zdCB0ZXh0ID0gWwogICAgICAgICAgICBlbC5nZXRBdHRyaWJ1dGUoImRhdGEtYXV0b21hdGlvbi1pZCIpLAogICAgICAgICAgICBlbC5nZXRBdHRyaWJ1dGUoImRhdGEtYXV0b21hdGlvbi1jb250ZXh0IiksCiAgICAgICAgICAgIGVsLmdldEF0dHJpYnV0ZSgiYXJpYS1sYWJlbCIpLAogICAgICAgICAgICBlbC5nZXRBdHRyaWJ1dGUoInRpdGxlIiksCiAgICAgICAgICAgIGVsLnRleHRDb250ZW50LAogICAgICAgICAgXQogICAgICAgICAgICAuZmlsdGVyKEJvb2xlYW4pCiAgICAgICAgICAgIC5qb2luKCIgIik7CiAgICAgICAgICBjb25zdCBuID0gbm9ybSh0ZXh0KTsKICAgICAgICAgIGxldCBzY29yZSA9IDA7CiAgICAgICAgICBpZiAobi5pbmNsdWRlcygic2VhcmNocmVzdWx0c2Ryb3Bkb3duIikpIHNjb3JlICs9IDg7CiAgICAgICAgICBpZiAobi5pbmNsdWRlcyhub3JtKFRBUkdFVF9DT05URVhUX0tFWVdPUkQpKSkgc2NvcmUgKz0gNTsKICAgICAgICAgIGlmIChuLmluY2x1ZGVzKCJtY2lkcHJpbWFyeWRlY3J5cHRlZGVxdWFscyIpKSBzY29yZSArPSA1OwogICAgICAgICAgaWYgKG4uaW5jbHVkZXMoImFsbCIpKSBzY29yZSArPSAxOwogICAgICAgICAgaWYgKChlbC5nZXRBdHRyaWJ1dGUoImFyaWEtaGFzcG9wdXAiKSB8fCAiIikudG9Mb3dlckNhc2UoKS5pbmNsdWRlcygibGlzdGJveCIpKSBzY29yZSArPSAxOwogICAgICAgICAgaWYgKCFpc1Zpc2libGUoZWwpKSBzY29yZSAtPSAxMDA7CiAgICAgICAgICBpZiAoc2NvcmUgPiBiZXN0U2NvcmUpIHsKICAgICAgICAgICAgYmVzdFNjb3JlID0gc2NvcmU7CiAgICAgICAgICAgIGJlc3QgPSBlbDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIGJlc3RTY29yZSA+PSA0ID8gYmVzdCA6IG51bGw7CiAgICB9CgogICAgYXN5bmMgZnVuY3Rpb24gZ2V0SWRWYWx1ZSgpIHsKICAgICAgY29uc3QgY2xlYW4gPSAodikgPT4KICAgICAgICBTdHJpbmcodiB8fCAiIikKICAgICAgICAgIC5yZXBsYWNlKC9cdTAwYTAvZywgIiAiKQogICAgICAgICAgLnJlcGxhY2UoL1tcclxuXHRdL2csICIiKQogICAgICAgICAgLnRyaW0oKTsKCiAgICAgIGlmIChTT1VSQ0VfSU5QVVRfU0VMRUNUT1IpIHsKICAgICAgICBjb25zdCBzcmMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFNPVVJDRV9JTlBVVF9TRUxFQ1RPUik7CiAgICAgICAgaWYgKCFzcmMpIHRocm93IG5ldyBFcnJvcihg5om+5LiN5Yiw5p2l5rqQ5paH5pys5qGGOiAke1NPVVJDRV9JTlBVVF9TRUxFQ1RPUn1gKTsKICAgICAgICBjb25zdCB2ID0gInZhbHVlIiBpbiBzcmMgPyBzcmMudmFsdWUgOiBzcmMudGV4dENvbnRlbnQ7CiAgICAgICAgY29uc3Qgb3V0ID0gY2xlYW4odik7CiAgICAgICAgaWYgKCFvdXQpIHRocm93IG5ldyBFcnJvcigi5p2l5rqQ5paH5pys5qGG5Li656m677yM6K+35YWI6L6T5YWlIElE44CCIik7CiAgICAgICAgcmV0dXJuIG91dDsKICAgICAgfQogICAgICB0cnkgewogICAgICAgIGlmIChuYXZpZ2F0b3IuY2xpcGJvYXJkPy5yZWFkVGV4dCkgewogICAgICAgICAgY29uc3QgY2xpcCA9IGNsZWFuKGF3YWl0IG5hdmlnYXRvci5jbGlwYm9hcmQucmVhZFRleHQoKSk7CiAgICAgICAgICBpZiAoY2xpcCkgcmV0dXJuIGNsaXA7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChfKSB7fQoKICAgICAgY29uc3QgdiA9IHdpbmRvdy5wcm9tcHQoIuivt+i+k+WFpeimgeaQnOe0oueahCBJRO+8iOWPr+ebtOaOpeeymOi0tO+8iToiLCAiIik7CiAgICAgIGNvbnN0IG91dCA9IGNsZWFuKHYpOwogICAgICBpZiAoIW91dCkgdGhyb3cgbmV3IEVycm9yKCLmnKrovpPlhaUgSUTvvIzlt7Llj5bmtojjgIIiKTsKICAgICAgcmV0dXJuIG91dDsKICAgIH0KCiAgICBmdW5jdGlvbiBvcGVuRHJvcGRvd25XaXRoTW91c2VTZXF1ZW5jZShlbCkgewogICAgICBjb25zdCBldmVudHMgPSBbInBvaW50ZXJkb3duIiwgIm1vdXNlZG93biIsICJwb2ludGVydXAiLCAibW91c2V1cCIsICJjbGljayJdOwogICAgICBmb3IgKGNvbnN0IHR5cGUgb2YgZXZlbnRzKSB7CiAgICAgICAgZWwuZGlzcGF0Y2hFdmVudChuZXcgTW91c2VFdmVudCh0eXBlLCB7IGJ1YmJsZXM6IHRydWUsIGNhbmNlbGFibGU6IHRydWUsIHZpZXc6IHdpbmRvdyB9KSk7CiAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBjZW50ZXJPZihlbCkgewogICAgICBjb25zdCByID0gZWwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICAgIHJldHVybiB7IHg6IHIubGVmdCArIHIud2lkdGggLyAyLCB5OiByLnRvcCArIHIuaGVpZ2h0IC8gMiB9OwogICAgfQoKICAgIGZ1bmN0aW9uIGRpc3RhbmNlKGEsIGIpIHsKICAgICAgY29uc3QgZHggPSBhLnggLSBiLng7CiAgICAgIGNvbnN0IGR5ID0gYS55IC0gYi55OwogICAgICByZXR1cm4gTWF0aC5zcXJ0KGR4ICogZHggKyBkeSAqIGR5KTsKICAgIH0KCiAgICBmdW5jdGlvbiBwaWNrQmVzdFNlYXJjaElucHV0KGlucHV0cywgZHJvcGRvd24pIHsKICAgICAgaWYgKCFpbnB1dHMubGVuZ3RoKSByZXR1cm4gbnVsbDsKICAgICAgY29uc3QgZHJvcGRvd25DZW50ZXIgPSBjZW50ZXJPZihkcm9wZG93bik7CiAgICAgIGxldCBiZXN0ID0gbnVsbDsKICAgICAgbGV0IGJlc3RTY29yZSA9IC1JbmZpbml0eTsKICAgICAgZm9yIChjb25zdCBlbCBvZiBpbnB1dHMpIHsKICAgICAgICBjb25zdCBwID0gbm9ybShlbC5nZXRBdHRyaWJ1dGUoInBsYWNlaG9sZGVyIikpOwogICAgICAgIGNvbnN0IGEgPSBub3JtKGVsLmdldEF0dHJpYnV0ZSgiYXJpYS1sYWJlbCIpKTsKICAgICAgICBjb25zdCBleGFjdCA9IHAgPT09ICJzZWFyY2h2YWx1ZSIgfHwgYSA9PT0gInNlYXJjaHZhbHVlIjsKICAgICAgICBjb25zdCBzY29yZUJ5VGV4dCA9IGV4YWN0ID8gMTAwIDogMTA7CiAgICAgICAgY29uc3Qgc2NvcmVCeURpc3RhbmNlID0gLWRpc3RhbmNlKGNlbnRlck9mKGVsKSwgZHJvcGRvd25DZW50ZXIpOwogICAgICAgIGNvbnN0IHNjb3JlID0gc2NvcmVCeVRleHQgKyBzY29yZUJ5RGlzdGFuY2U7CiAgICAgICAgaWYgKHNjb3JlID4gYmVzdFNjb3JlKSB7CiAgICAgICAgICBiZXN0U2NvcmUgPSBzY29yZTsKICAgICAgICAgIGJlc3QgPSBlbDsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIGJlc3Q7CiAgICB9CgogICAgYXN5bmMgZnVuY3Rpb24gd2FpdFNlYXJjaElucHV0KGRyb3Bkb3duLCB0aW1lb3V0TXMgPSA4MDAwKSB7CiAgICAgIGNvbnN0IHN0YXJ0ID0gRGF0ZS5ub3coKTsKICAgICAgd2hpbGUgKERhdGUubm93KCkgLSBzdGFydCA8IHRpbWVvdXRNcykgewogICAgICAgIGNvbnN0IGFsbFZpc2libGVJbnB1dHMgPSBbXTsKICAgICAgICBmb3IgKGNvbnN0IHJvb3Qgb2YgZ2V0Um9vdHMoZG9jdW1lbnQpKSB7CiAgICAgICAgICBjb25zdCBpbnB1dHMgPSBxdWVyeUFsbERlZXAocm9vdCwgJ2lucHV0W3BsYWNlaG9sZGVyPSJTZWFyY2ggdmFsdWUiXSwgaW5wdXRbYXJpYS1sYWJlbD0iU2VhcmNoIHZhbHVlIl0sIGlucHV0W3R5cGU9InRleHQiXScpOwogICAgICAgICAgYWxsVmlzaWJsZUlucHV0cy5wdXNoKC4uLmlucHV0cy5maWx0ZXIoKGVsKSA9PiBpc1Zpc2libGUoZWwpICYmICFlbC5kaXNhYmxlZCkpOwogICAgICAgIH0KICAgICAgICBjb25zdCB0YXJnZXQgPSBwaWNrQmVzdFNlYXJjaElucHV0KGFsbFZpc2libGVJbnB1dHMsIGRyb3Bkb3duKTsKICAgICAgICBpZiAodGFyZ2V0KSByZXR1cm4gdGFyZ2V0OwogICAgICAgIGF3YWl0IHNsZWVwKDEyMCk7CiAgICAgIH0KICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgYXN5bmMgZnVuY3Rpb24gdHlwZUludG9BdXRvY29tcGxldGUoaW5wdXQsIHZhbHVlKSB7CiAgICAgIGNvbnN0IG5hdGl2ZVNldHRlciA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoCiAgICAgICAgd2luZG93LkhUTUxJbnB1dEVsZW1lbnQucHJvdG90eXBlLAogICAgICAgICJ2YWx1ZSIKICAgICAgKT8uc2V0OwogICAgICBjb25zdCBzZXRWYWx1ZSA9ICh2KSA9PiB7CiAgICAgICAgaWYgKG5hdGl2ZVNldHRlcikgbmF0aXZlU2V0dGVyLmNhbGwoaW5wdXQsIHYpOwogICAgICAgIGVsc2UgaW5wdXQudmFsdWUgPSB2OwogICAgICB9OwoKICAgICAgaW5wdXQuZm9jdXMoKTsKICAgICAgaW5wdXQuY2xpY2soKTsKICAgICAgYXdhaXQgc2xlZXAoNjApOwoKICAgICAgc2V0VmFsdWUoIiIpOwogICAgICBpbnB1dC5kaXNwYXRjaEV2ZW50KG5ldyBJbnB1dEV2ZW50KCJpbnB1dCIsIHsgYnViYmxlczogdHJ1ZSwgaW5wdXRUeXBlOiAiZGVsZXRlQ29udGVudEJhY2t3YXJkIiwgZGF0YTogbnVsbCB9KSk7CiAgICAgIGF3YWl0IHNsZWVwKDQwKTsKCiAgICAgIGxldCBjdXJyZW50ID0gIiI7CiAgICAgIGZvciAoY29uc3QgY2ggb2YgU3RyaW5nKHZhbHVlKSkgewogICAgICAgIGN1cnJlbnQgKz0gY2g7CiAgICAgICAgaW5wdXQuZGlzcGF0Y2hFdmVudChuZXcgS2V5Ym9hcmRFdmVudCgia2V5ZG93biIsIHsga2V5OiBjaCwgYnViYmxlczogdHJ1ZSB9KSk7CiAgICAgICAgc2V0VmFsdWUoY3VycmVudCk7CiAgICAgICAgaW5wdXQuZGlzcGF0Y2hFdmVudChuZXcgSW5wdXRFdmVudCgiaW5wdXQiLCB7IGJ1YmJsZXM6IHRydWUsIGlucHV0VHlwZTogImluc2VydFRleHQiLCBkYXRhOiBjaCB9KSk7CiAgICAgICAgaW5wdXQuZGlzcGF0Y2hFdmVudChuZXcgS2V5Ym9hcmRFdmVudCgia2V5dXAiLCB7IGtleTogY2gsIGJ1YmJsZXM6IHRydWUgfSkpOwogICAgICAgIGF3YWl0IHNsZWVwKDI1KTsKICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGZpbmRQYW5lbFJvb3Qoc2VhcmNoSW5wdXQsIGRyb3Bkb3duKSB7CiAgICAgIGNvbnN0IGZyb21JbnB1dCA9IHNlYXJjaElucHV0Py5jbG9zZXN0KAogICAgICAgICcuTXVpUG9wb3Zlci1wYXBlciwgLk11aU1lbnUtcGFwZXIsIC5NdWlQYXBlci1yb290LCBbcm9sZT0iZGlhbG9nIl0sIFtyb2xlPSJwcmVzZW50YXRpb24iXScKICAgICAgKTsKICAgICAgaWYgKGZyb21JbnB1dCkgcmV0dXJuIGZyb21JbnB1dDsKCiAgICAgIGNvbnN0IGZyb21Ecm9wZG93biA9IGRyb3Bkb3duPy5jbG9zZXN0KAogICAgICAgICcuTXVpUG9wb3Zlci1wYXBlciwgLk11aU1lbnUtcGFwZXIsIC5NdWlQYXBlci1yb290LCBbcm9sZT0iZGlhbG9nIl0sIFtyb2xlPSJwcmVzZW50YXRpb24iXScKICAgICAgKTsKICAgICAgaWYgKGZyb21Ecm9wZG93bikgcmV0dXJuIGZyb21Ecm9wZG93bjsKCiAgICAgIHJldHVybiBkb2N1bWVudDsKICAgIH0KCiAgICBmdW5jdGlvbiBmaW5kU2VhcmNoQnV0dG9uSW5QYW5lbChzY29wZVJvb3QpIHsKICAgICAgaWYgKHdpbmRvdy5qUXVlcnkpIHsKICAgICAgICBjb25zdCAkID0gd2luZG93LmpRdWVyeTsKICAgICAgICBjb25zdCAkYnRuID0gJChzY29wZVJvb3QpCiAgICAgICAgICAuZmluZCgnYnV0dG9uW2RhdGEtYXV0b21hdGlvbi1pZCo9InNlYXJjaCJdLCBidXR0b24nKQogICAgICAgICAgLmZpbHRlcigoXywgZWwpID0+IG5vcm0oJChlbCkudGV4dCgpKSA9PT0gInNlYXJjaCIgfHwgbm9ybSgkKGVsKS50ZXh0KCkpLmVuZHNXaXRoKCJzZWFyY2giKSkKICAgICAgICAgIC5maXJzdCgpOwogICAgICAgIGlmICgkYnRuLmxlbmd0aCAmJiBpc1Zpc2libGUoJGJ0blswXSkpIHJldHVybiAkYnRuWzBdOwogICAgICB9CgogICAgICBjb25zdCBidG5zID0gcXVlcnlBbGxEZWVwKHNjb3BlUm9vdCwgJ2J1dHRvbiwgW3JvbGU9ImJ1dHRvbiJdJyk7CiAgICAgIHJldHVybiBidG5zLmZpbmQoKGVsKSA9PiB7CiAgICAgICAgaWYgKCFpc1Zpc2libGUoZWwpKSByZXR1cm4gZmFsc2U7CiAgICAgICAgY29uc3QgdCA9IG5vcm0oCiAgICAgICAgICBbCiAgICAgICAgICAgIGVsLmdldEF0dHJpYnV0ZSgiZGF0YS1hdXRvbWF0aW9uLWlkIiksCiAgICAgICAgICAgIGVsLmdldEF0dHJpYnV0ZSgiYXJpYS1sYWJlbCIpLAogICAgICAgICAgICBlbC5nZXRBdHRyaWJ1dGUoInRpdGxlIiksCiAgICAgICAgICAgIGVsLnRleHRDb250ZW50LAogICAgICAgICAgXQogICAgICAgICAgICAuZmlsdGVyKEJvb2xlYW4pCiAgICAgICAgICAgIC5qb2luKCIgIikKICAgICAgICApOwogICAgICAgIHJldHVybiB0LmluY2x1ZGVzKCJwYWdpbmF0ZWRzZWFyY2hjb21wb25lbnRzZWFyY2giKSB8fCB0ID09PSAic2VhcmNoIiB8fCB0LmVuZHNXaXRoKCJzZWFyY2giKTsKICAgICAgfSkgfHwgbnVsbDsKICAgIH0KCiAgICBhc3luYyBmdW5jdGlvbiB3YWl0U2VhcmNoQnV0dG9uKHNjb3BlUm9vdCwgdGltZW91dE1zID0gODAwMCkgewogICAgICBjb25zdCBzdGFydCA9IERhdGUubm93KCk7CiAgICAgIHdoaWxlIChEYXRlLm5vdygpIC0gc3RhcnQgPCB0aW1lb3V0TXMpIHsKICAgICAgICBjb25zdCBidG4gPSBmaW5kU2VhcmNoQnV0dG9uSW5QYW5lbChzY29wZVJvb3QpOwogICAgICAgIGlmIChidG4pIHJldHVybiBidG47CiAgICAgICAgYXdhaXQgc2xlZXAoMTIwKTsKICAgICAgfQogICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICBmdW5jdGlvbiBmaW5kTWluaW1pemVCdXR0b24oKSB7CiAgICAgIGNvbnN0IGJ5QXV0b21hdGlvbklkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigKICAgICAgICAnYnV0dG9uW2RhdGEtYXV0b21hdGlvbi1pZD0iYW5hbHlzaXNfdmlzdWFsX2Ryb3Bkb3duX21pbmltaXplIl0nCiAgICAgICk7CiAgICAgIGlmIChieUF1dG9tYXRpb25JZCAmJiBpc1Zpc2libGUoYnlBdXRvbWF0aW9uSWQpKSByZXR1cm4gYnlBdXRvbWF0aW9uSWQ7CiAgICAgIGNvbnN0IGJ5QXV0b21hdGlvbklkV2l0aFNwYWNlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigKICAgICAgICAnYnV0dG9uW2RhdGEtYXV0b21hdGlvbi1pZD0iYW5hbHlzaXNfdmlzdWFsIGRyb3Bkb3duX21pbmltaXplIl0nCiAgICAgICk7CiAgICAgIGlmIChieUF1dG9tYXRpb25JZFdpdGhTcGFjZSAmJiBpc1Zpc2libGUoYnlBdXRvbWF0aW9uSWRXaXRoU3BhY2UpKSByZXR1cm4gYnlBdXRvbWF0aW9uSWRXaXRoU3BhY2U7CgogICAgICBjb25zdCBjYW5kaWRhdGVzID0gcXVlcnlBbGxEZWVwKGRvY3VtZW50LCAnYnV0dG9uLCBbcm9sZT0iYnV0dG9uIl0nKTsKICAgICAgZm9yIChjb25zdCBlbCBvZiBjYW5kaWRhdGVzKSB7CiAgICAgICAgaWYgKCFpc1Zpc2libGUoZWwpKSBjb250aW51ZTsKICAgICAgICBjb25zdCB0ID0gbm9ybSgKICAgICAgICAgIFsKICAgICAgICAgICAgZWwuZ2V0QXR0cmlidXRlKCJkYXRhLWF1dG9tYXRpb24taWQiKSwKICAgICAgICAgICAgZWwuZ2V0QXR0cmlidXRlKCJhcmlhLWxhYmVsIiksCiAgICAgICAgICAgIGVsLmdldEF0dHJpYnV0ZSgidGl0bGUiKSwKICAgICAgICAgICAgZWwudGV4dENvbnRlbnQsCiAgICAgICAgICBdCiAgICAgICAgICAgIC5maWx0ZXIoQm9vbGVhbikKICAgICAgICAgICAgLmpvaW4oIiAiKQogICAgICAgICk7CiAgICAgICAgaWYgKHQuaW5jbHVkZXMoImFuYWx5c2lzdmlzdWFsZHJvcGRvd25taW5pbWl6ZSIpIHx8IHQuaW5jbHVkZXMoIm1pbmltaXplIikpIHsKICAgICAgICAgIHJldHVybiBlbDsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgZnVuY3Rpb24gZmluZEFkZGl0aW9uYWxNaW5pbWl6ZUJ1dHRvbigpIHsKICAgICAgY29uc3Qgc2VsZWN0b3JzID0gWwogICAgICAgICdidXR0b25bZGF0YS1hdXRvbWF0aW9uLWlkPSJhbmFseXNpc192aXN1YWwgZHJvcGRvd25fbWluaW1pemUiXScsCiAgICAgICAgJ2J1dHRvblt0aXRsZT0iTWluaW1pemUiXVthcmlhLWxhYmVsKj0iUmVsYXRlZCBzZWxsZXJzIl0nLAogICAgICAgICdidXR0b25bYXJpYS1sYWJlbCo9Ik1pbmltaXplIl1bYXJpYS1sYWJlbCo9IlJlbGF0ZWQgc2VsbGVycyJdJywKICAgICAgXTsKICAgICAgZm9yIChjb25zdCBzZWxlY3RvciBvZiBzZWxlY3RvcnMpIHsKICAgICAgICBjb25zdCBlbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3IpOwogICAgICAgIGlmIChlbCAmJiBpc1Zpc2libGUoZWwpKSByZXR1cm4gZWw7CiAgICAgIH0KICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgYXN5bmMgZnVuY3Rpb24gd2FpdE1pbmltaXplQnV0dG9uKHRpbWVvdXRNcyA9IDgwMDApIHsKICAgICAgY29uc3Qgc3RhcnQgPSBEYXRlLm5vdygpOwogICAgICB3aGlsZSAoRGF0ZS5ub3coKSAtIHN0YXJ0IDwgdGltZW91dE1zKSB7CiAgICAgICAgY29uc3QgYnRuID0gZmluZE1pbmltaXplQnV0dG9uKCk7CiAgICAgICAgaWYgKGJ0bikgcmV0dXJuIGJ0bjsKICAgICAgICBhd2FpdCBzbGVlcCgxMjApOwogICAgICB9CiAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIGZ1bmN0aW9uIGZpbmRTZWxlY3RBbGxJblBhbmVsKHNjb3BlUm9vdCkgewogICAgICBjb25zdCBieUlkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm9wdGlvbi1zZWxlY3QtYWxsIik7CiAgICAgIGlmIChieUlkICYmIGlzVmlzaWJsZShieUlkKSkgcmV0dXJuIGJ5SWQ7CgogICAgICBpZiAod2luZG93LmpRdWVyeSkgewogICAgICAgIGNvbnN0ICQgPSB3aW5kb3cualF1ZXJ5OwogICAgICAgIGNvbnN0ICRieUlkID0gJCgiI29wdGlvbi1zZWxlY3QtYWxsIik7CiAgICAgICAgaWYgKCRieUlkLmxlbmd0aCAmJiBpc1Zpc2libGUoJGJ5SWRbMF0pKSByZXR1cm4gJGJ5SWRbMF07CgogICAgICAgIGNvbnN0ICRoaXQgPSAkKHNjb3BlUm9vdCkKICAgICAgICAgIC5maW5kKCdbcm9sZT0ib3B0aW9uIl0sIGxpLCBkaXYsIHNwYW4sIGxhYmVsJykKICAgICAgICAgIC5maWx0ZXIoKF8sIGVsKSA9PiAvc2VsZWN0IGFsbCByZXN1bHRzL2kudGVzdCgkKGVsKS50ZXh0KCkpKQogICAgICAgICAgLmZpcnN0KCk7CiAgICAgICAgaWYgKCRoaXQubGVuZ3RoKSByZXR1cm4gJGhpdFswXS5jbG9zZXN0KCdbcm9sZT0ib3B0aW9uIl0sIGxpLCBkaXYsIGxhYmVsJykgfHwgJGhpdFswXTsKICAgICAgfQoKICAgICAgY29uc3QgY2FuZGlkYXRlcyA9IHF1ZXJ5QWxsRGVlcChzY29wZVJvb3QsICdbcm9sZT0ib3B0aW9uIl0sIGxpLCBkaXYsIHNwYW4sIGxhYmVsJyk7CiAgICAgIGZvciAoY29uc3QgZWwgb2YgY2FuZGlkYXRlcykgewogICAgICAgIGlmICghaXNWaXNpYmxlKGVsKSkgY29udGludWU7CiAgICAgICAgaWYgKC9zZWxlY3QgYWxsIHJlc3VsdHMvaS50ZXN0KChlbC50ZXh0Q29udGVudCB8fCAiIikudHJpbSgpKSkgewogICAgICAgICAgcmV0dXJuIGVsLmNsb3Nlc3QoJ1tyb2xlPSJvcHRpb24iXSwgbGksIGRpdiwgbGFiZWwnKSB8fCBlbDsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgY29uc3QgaWRWYWx1ZSA9IGF3YWl0IGdldElkVmFsdWUoKTsKICAgIGNvbnN0IGRyb3Bkb3duID0gcGlja0Ryb3Bkb3duKCk7CiAgICBpZiAoIWRyb3Bkb3duKSB0aHJvdyBuZXcgRXJyb3IoIuaJvuS4jeWIsOS4i+aLieaMiemSru+8iEFsbCDlj7PkvqfkuInop5LvvInjgIIiKTsKCiAgICBvcGVuRHJvcGRvd25XaXRoTW91c2VTZXF1ZW5jZShkcm9wZG93bik7CiAgICBhd2FpdCBzbGVlcCgyMjApOwoKICAgIGxldCBzZWFyY2hJbnB1dCA9IGF3YWl0IHdhaXRTZWFyY2hJbnB1dChkcm9wZG93biwgMTIwMCk7CiAgICBpZiAoIXNlYXJjaElucHV0KSB7CiAgICAgIG9wZW5Ecm9wZG93bldpdGhNb3VzZVNlcXVlbmNlKGRyb3Bkb3duKTsKICAgICAgYXdhaXQgc2xlZXAoMjIwKTsKICAgICAgc2VhcmNoSW5wdXQgPSBhd2FpdCB3YWl0U2VhcmNoSW5wdXQoZHJvcGRvd24sIDEwMDAwKTsKICAgIH0KICAgIGlmICghc2VhcmNoSW5wdXQpIHRocm93IG5ldyBFcnJvcigi5LiL5ouJ5bey54K55Ye777yM5L2G5om+5LiN5YiwIFNlYXJjaCB2YWx1ZSDovpPlhaXmoYbjgIIiKTsKCiAgICBzZWFyY2hJbnB1dC5mb2N1cygpOwogICAgYXdhaXQgdHlwZUludG9BdXRvY29tcGxldGUoc2VhcmNoSW5wdXQsIGlkVmFsdWUpOwogICAgaWYgKCFzZWFyY2hJbnB1dC5pc0Nvbm5lY3RlZCB8fCAhaXNWaXNpYmxlKHNlYXJjaElucHV0KSkgewogICAgICBvcGVuRHJvcGRvd25XaXRoTW91c2VTZXF1ZW5jZShkcm9wZG93bik7CiAgICAgIGF3YWl0IHNsZWVwKDIyMCk7CiAgICAgIHNlYXJjaElucHV0ID0gYXdhaXQgd2FpdFNlYXJjaElucHV0KGRyb3Bkb3duLCAzMDAwKTsKICAgICAgaWYgKCFzZWFyY2hJbnB1dCkgdGhyb3cgbmV3IEVycm9yKCLovpPlhaXlkI7pnaLmnb/lhbPpl63vvIzkuJTml6Dms5Xph43mlrDlrprkvY0gU2VhcmNoIHZhbHVlIOi+k+WFpeahhuOAgiIpOwogICAgICBhd2FpdCB0eXBlSW50b0F1dG9jb21wbGV0ZShzZWFyY2hJbnB1dCwgaWRWYWx1ZSk7CiAgICB9CiAgICBpZiAoKHNlYXJjaElucHV0LnZhbHVlIHx8ICIiKS50cmltKCkgIT09IGlkVmFsdWUpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKGBJRCDmnKrmiJDlip/lhpnlhaXmkJzntKLmoYbjgILlvZPliY3lgLw6ICIke3NlYXJjaElucHV0LnZhbHVlIHx8ICIifSJgKTsKICAgIH0KICAgIGF3YWl0IHNsZWVwKDI1MCk7CgogICAgY29uc3QgcGFuZWxSb290ID0gZmluZFBhbmVsUm9vdChzZWFyY2hJbnB1dCwgZHJvcGRvd24pOwogICAgY29uc3Qgc2VhcmNoQnRuID0gYXdhaXQgd2FpdFNlYXJjaEJ1dHRvbihwYW5lbFJvb3QsIDEwMDAwKTsKICAgIGlmICghc2VhcmNoQnRuKSB0aHJvdyBuZXcgRXJyb3IoIuW3suWhq+WFpSBJRO+8jOS9huaJvuS4jeWIsCBTZWFyY2gg5oyJ6ZKu44CCIik7CgogICAgc2VhcmNoQnRuLmNsaWNrKCk7CiAgICBhd2FpdCBzbGVlcCgyMDAwKTsKCiAgICBjb25zdCBzZWxlY3RBbGwgPSBmaW5kU2VsZWN0QWxsSW5QYW5lbChwYW5lbFJvb3QpOwogICAgaWYgKCFzZWxlY3RBbGwpIHRocm93IG5ldyBFcnJvcigiU2VhcmNoIOW3sueCueWHu++8jOS9huaJvuS4jeWIsCBTZWxlY3QgYWxsIHJlc3VsdHPjgIIiKTsKICAgIHNlbGVjdEFsbC5jbGljaygpOwoKICAgIGF3YWl0IHNsZWVwKDI1MCk7CiAgICBjb25zdCBtaW5pbWl6ZUJ0biA9IGF3YWl0IHdhaXRNaW5pbWl6ZUJ1dHRvbigxMDAwMCk7CiAgICBpZiAoIW1pbmltaXplQnRuKSB0aHJvdyBuZXcgRXJyb3IoIuW3suWujOaIkCBTZWxlY3QgYWxsIHJlc3VsdHPvvIzkvYbmib7kuI3liLAgTWluaW1pemUg5oyJ6ZKu44CCIik7CiAgICBtaW5pbWl6ZUJ0bi5jbGljaygpOwogICAgYXdhaXQgc2xlZXAoMjAwKTsKCiAgICBjb25zdCBleHRyYU1pbmltaXplQnRuID0gZmluZEFkZGl0aW9uYWxNaW5pbWl6ZUJ1dHRvbigpOwogICAgaWYgKGV4dHJhTWluaW1pemVCdG4pIGV4dHJhTWluaW1pemVCdG4uY2xpY2soKTsKICB9CgogIGNvbnN0IHNsZWVwID0gKG1zKSA9PiBuZXcgUHJvbWlzZSgocikgPT4gc2V0VGltZW91dChyLCBtcykpOwogIGF3YWl0IHJ1bkNsaWNrUmVzZXQoKTsKICBhd2FpdCBzbGVlcCgxMDAwKTsKICBhd2FpdCBydW5GaWxsSWRBbmRTZWFyY2goKTsKICBjb25zb2xlLmxvZygi5a6M5oiQ77ya5bey5omn6KGMIGNsaWNrLXJlc2V0ICsgZmlsbC1pZC1hbmQtc2VhcmNo44CCIik7Cn0pKCk7Cg=="));})();